<?xml version="1.0" encoding="utf-8"?> <!-- -*- nxml -*- -->
<transfer default="chunk">
  <section-def-cats>
    <def-cat n="nom">
      <cat-item tags="n.*"/>
    </def-cat>

    <def-cat n="np">
      <cat-item tags="np.*"/>
    </def-cat>

    <def-cat n="top">
      <cat-item tags="np.top.*"/>
      <cat-item tags="np.hyd.*"/>
    </def-cat>
    <def-cat n="ant_cog">
      <cat-item tags="np.ant.*"/>
      <cat-item tags="np.cog.*"/>
    </def-cat>
    <def-cat n="ant">
      <cat-item tags="np.ant.*"/>
    </def-cat>
    <def-cat n="cog">
      <cat-item tags="np.cog.*"/>
    </def-cat>
    <def-cat n="al">
      <cat-item tags="np.al.*"/>
    </def-cat>

    <def-cat n="adj">
      <cat-item tags="adj.m.*"/>
      <cat-item tags="adj.f.*"/>
      <cat-item tags="adj.mf.*"/>
      <cat-item tags="adj.GD.*"/>
      <cat-item tags="adj.pos.*"/>
      <cat-item tags="adj.ind.*"/>
      <cat-item tags="adj.ord.*"/>
      <cat-item tags="adj.itg.*"/>
    </def-cat>
    <def-cat n="adjsup">
      <cat-item tags="adj.sup.*"/>
    </def-cat>
    <def-cat n="adjec">
      <cat-item tags="adj.m.*"/>
      <cat-item tags="adj.f.*"/>
      <cat-item tags="adj.mf.*"/>
      <cat-item tags="adj.GD.*"/>
      <cat-item tags="adj.pos.*"/>
      <cat-item tags="adj.ind.*"/>
      <cat-item tags="adj.ord.*"/>
      <cat-item tags="adj.itg.*"/>
      <cat-item tags="vblex.pp.*"/>
    </def-cat>
    <def-cat n="habitual">
      <cat-item lemma="habitual" tags="adj.*"/>
    </def-cat>

    <def-cat n="adv_preadv">
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
    </def-cat>
    <def-cat n="adv">
      <cat-item tags="adv"/>
    </def-cat>
    <def-cat n="tot_adv">
      <cat-item lemma="tot" tags="adv"/>
    </def-cat>
    <def-cat n="gens">
      <cat-item lemma="gens" tags="adv"/>
    </def-cat>
    <def-cat n="nomes">
      <cat-item lemma="només" tags="adv"/>
    </def-cat>
    <def-cat n="mes_menys">
      <cat-item lemma="més" tags="adv"/>
      <cat-item lemma="menys" tags="adv"/>
      <cat-item lemma="molt més" tags="adv"/>
      <cat-item lemma="molt menys" tags="adv"/>
    </def-cat>

    <def-cat n="prn">
      <cat-item tags="prn.*"/>
    </def-cat>
    <def-cat n="prnpro">
      <cat-item tags="prn.pro.*"/>
    </def-cat>
    <def-cat n="prnenc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>
    <def-cat n="tot_prn">
      <cat-item lemma="tot" tags="prn.*"/>
    </def-cat>
    <def-cat n="prnpers_subj">
      <cat-item lemma="jo" tags="prn.tn.*"/>
      <cat-item lemma="tu" tags="prn.tn.*"/>
      <cat-item lemma="ell" tags="prn.tn.*"/>
      <cat-item lemma="nosaltres" tags="prn.tn.*"/>
      <cat-item lemma="vosaltres" tags="prn.tn.*"/>
      <cat-item lemma="ells" tags="prn.tn.*"/>
      <cat-item lemma="vostè" tags="prn.tn.*"/>
    </def-cat>
    <def-cat n="prnpers_subj_sense_ells">
      <cat-item lemma="jo" tags="prn.tn.*"/>
      <cat-item lemma="tu" tags="prn.tn.*"/>
      <cat-item lemma="ell" tags="prn.tn.p3.m.sg"/>
      <cat-item lemma="ell" tags="prn.tn.p3.m.pl"/>
      <cat-item lemma="nosaltres" tags="prn.tn.*"/>
      <cat-item lemma="vosaltres" tags="prn.tn.*"/>
      <cat-item lemma="ells" tags="prn.tn.*"/>
      <cat-item lemma="vostè" tags="prn.tn.p3.mf.sg"/>
    </def-cat>
    <def-cat n="prnproref">
      <cat-item lemma="em" tags="prn.pro.p1.mf.sg"/>
      <cat-item lemma="et" tags="prn.pro.p2.mf.sg"/>
      <cat-item lemma="es" tags="prn.pro.ref.p3.mf.sp"/>
      <cat-item lemma="ens" tags="prn.pro.p1.mf.pl"/>
      <cat-item lemma="us" tags="prn.pro.p2.mf.pl"/>
    </def-cat>
    <def-cat n="prnpropers">
      <cat-item tags="prn.pro.p1.*"/>
      <cat-item tags="prn.pro.p2.*"/>
      <cat-item tags="prn.pro.p3.*"/>
      <cat-item tags="prn.pro.ref.p3.*"/>
    </def-cat>
    <def-cat n="es">
      <cat-item lemma="es" tags="prn.pro.ref.p3.mf.sp"/>
    </def-cat>
    <def-cat n="en_prn">
      <cat-item lemma="en" tags="prn.pro.adv"/>
    </def-cat>
    <def-cat n="hi">
      <cat-item lemma="hi" tags="prn.pro.adv"/>
    </def-cat>

    <def-cat n="det">          
      <cat-item tags="det.*"/>
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="det_def">          
      <cat-item tags="det.def.*"/>
    </def-cat>
    <def-cat n="el">          
      <cat-item lemma="el" tags="det.def.*"/>
    </def-cat>
    <def-cat n="el_m_sg">          
      <cat-item lemma="el" tags="det.def.m.sg"/>
    </def-cat>
    <def-cat n="uns_propde">          
      <cat-item lemma="un" tags="det.ind.m.pl"/>
      <cat-item lemma="un" tags="det.ind.f.pl"/>
      <cat-item lemma="prop de" tags="pr"/>
    </def-cat>
    <def-cat n="predet">          
      <cat-item tags="predet.*"/>
    </def-cat>

    <def-cat n="num">
      <cat-item tags="num.*"/>
      <cat-item tags="num"/>
    </def-cat>
    <def-cat n="dia">
      <cat-item tags="num"/>
    </def-cat>
    <def-cat n="any">
      <cat-item tags="num"/>
    </def-cat>

    <def-cat n="num_det_adj">
      <cat-item tags="num.*"/>
      <cat-item tags="num"/>
      <cat-item tags="det.*"/>
      <cat-item tags="adj.*"/>
    </def-cat>

    <def-cat n="cnjadv">
      <cat-item tags="cnjadv"/>
    </def-cat>

    <def-cat n="cnjcoo">
      <cat-item tags="cnjcoo"/>
    </def-cat>
    <def-cat n="i">
      <cat-item lemma="i" tags="cnjcoo"/>
    </def-cat>

    <def-cat n="cnjsub">
      <cat-item tags="cnjsub"/>
    </def-cat>
    <def-cat n="que">
      <cat-item lemma="que" tags="cnjsub"/>
    </def-cat>

    <def-cat n="rel">
      <cat-item tags="rel.*"/>
    </def-cat>

    <def-cat n="pr">
      <cat-item tags="pr"/>
    </def-cat>
    <def-cat n="a">
      <cat-item lemma="a" tags="pr"/>
    </def-cat>
    <def-cat n="de">
      <cat-item lemma="de" tags="pr"/>
    </def-cat>

    <def-cat n="vbser">
      <cat-item tags="vbser.*"/>
    </def-cat>
    <def-cat n="vbhaver">
      <cat-item tags="vbhaver.*"/>
    </def-cat>

    <def-cat n="pp">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbhaver.pp.*"/>
    </def-cat>

    <def-cat n="pp_sg">
      <cat-item tags="vblex.pp.*.sg"/>
      <cat-item tags="vbser.pp.*.sg"/>
      <cat-item tags="vbmod.pp.*.sg"/>
      <cat-item tags="vbhaver.pp.*.sg"/>
    </def-cat>

    <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbmod.ger"/>
      <cat-item tags="vbhaver.ger"/>
      <cat-item tags="vbser.ger"/>
    </def-cat>

    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbmod.inf"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbser.inf"/>
    </def-cat>
    <def-cat n="haver_inf">
      <cat-item tags="vbhaver.inf"/>
    </def-cat>

    <def-cat n="imp">
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vbmod.imp.*"/>
      <cat-item tags="vbhaver.imp.*"/>
      <cat-item tags="vbser.imp.*"/>
    </def-cat>

    <def-cat n="pprs">
      <cat-item tags="vblex.pprs.*"/>
      <cat-item tags="vbmod.pprs.*"/>
      <cat-item tags="vbhaver.pprs.*"/>
      <cat-item tags="vbser.pprs.*"/>
    </def-cat>

    <def-cat n="vfin">
      <cat-item tags="vblex.pri.*"/>
      <cat-item tags="vblex.pii.*"/>
      <cat-item tags="vblex.ifi.*"/>
      <cat-item tags="vblex.prs.*"/>
      <cat-item tags="vblex.fti.*"/>
      <cat-item tags="vblex.pis.*"/>
      <cat-item tags="vblex.cni.*"/>
      <cat-item tags="vbmod.pri.*"/>
      <cat-item tags="vbmod.pii.*"/>
      <cat-item tags="vbmod.ifi.*"/>
      <cat-item tags="vbmod.prs.*"/>
      <cat-item tags="vbmod.fti.*"/>
      <cat-item tags="vbmod.cni.*"/>
      <cat-item tags="vbmod.pis.*"/>
      <cat-item tags="vbser.pri.*"/>
      <cat-item tags="vbser.pii.*"/>
      <cat-item tags="vbser.ifi.*"/>
      <cat-item tags="vbser.prs.*"/>
      <cat-item tags="vbser.fti.*"/>
      <cat-item tags="vbser.pis.*"/>
      <cat-item tags="vbser.cni.*"/>
    </def-cat>

    <def-cat n="haverfin">
      <cat-item tags="vbhaver.pri.*"/>
      <cat-item tags="vbhaver.pii.*"/>
      <cat-item tags="vbhaver.ifi.*"/>
      <cat-item tags="vbhaver.prs.*"/>
      <cat-item tags="vbhaver.fti.*"/>
      <cat-item tags="vbhaver.pis.*"/>
      <cat-item tags="vbhaver.cni.*"/>
    </def-cat>
    <def-cat n="haverp3"> <!-- accepta pl, tot i que "hi han llibres" no és normatiu -->
      <cat-item tags="vbhaver.pri.p3.*"/>
      <cat-item tags="vbhaver.pii.p3.*"/>
      <cat-item tags="vbhaver.ifi.p3.*"/>
      <cat-item tags="vbhaver.prs.p3.*"/>
      <cat-item tags="vbhaver.fti.p3.*"/>
      <cat-item tags="vbhaver.pis.p3.*"/>
      <cat-item tags="vbhaver.cni.p3.*"/>
    </def-cat>

    <def-cat n="caldre">
       <cat-item lemma="caldre" tags="vbmod.*"/>
    </def-cat>
    <def-cat n="caldrefin">
      <cat-item lemma="caldre" tags="vbmod.pri.*"/>
      <cat-item lemma="caldre" tags="vbmod.pii.*"/>
      <cat-item lemma="caldre" tags="vbmod.ifi.*"/>
      <cat-item lemma="caldre" tags="vbmod.prs.*"/>
      <cat-item lemma="caldre" tags="vbmod.fti.*"/>
      <cat-item lemma="caldre" tags="vbmod.pis.*"/>
      <cat-item lemma="caldre" tags="vbmod.cni.*"/>
    </def-cat>
    <def-cat n="caldreinf_ger">
      <cat-item lemma="caldre" tags="vbmod.inf"/>
      <cat-item lemma="caldre" tags="vbmod.ger"/>
    </def-cat>
    <def-cat n="caldreinf">
      <cat-item lemma="caldre" tags="vbmod.inf"/>
    </def-cat>
    <def-cat n="caldrepp">
      <cat-item lemma="caldre" tags="vbmod.pp.*"/>
    </def-cat>

    <def-cat n="necessitarp3">
      <cat-item lemma="necessitar" tags="vblex.pri.p3.*"/>
      <cat-item lemma="necessitar" tags="vblex.pii.p3.*"/>
      <cat-item lemma="necessitar" tags="vblex.ifi.p3.*"/>
      <cat-item lemma="necessitar" tags="vblex.prs.p3.*"/>
      <cat-item lemma="necessitar" tags="vblex.fti.p3.*"/>
      <cat-item lemma="necessitar" tags="vblex.pis.p3.*"/>
      <cat-item lemma="necessitar" tags="vblex.cni.p3.*"/>
    </def-cat>

    <def-cat n="anar_pri">
       <cat-item lemma="anar" tags="vblex.pri.*"/>
    </def-cat>
    <def-cat n="anar_pri_p3">
       <cat-item lemma="anar" tags="vblex.pri.p3.*"/>
    </def-cat>
    <def-cat n="fa">
      <cat-item lemma="fer" tags="vblex.pri.p3.sg"/>
    </def-cat>

    <def-cat n="mes">
       <cat-item lemma="gener" tags="n.*"/>
       <cat-item lemma="febrer" tags="n.*"/>
       <cat-item lemma="març" tags="n.*"/>
       <cat-item lemma="abril" tags="n.*"/>
       <cat-item lemma="maig" tags="n.*"/>
       <cat-item lemma="juny" tags="n.*"/>
       <cat-item lemma="juliol" tags="n.*"/>
       <cat-item lemma="agost" tags="n.*"/>
       <cat-item lemma="setembre" tags="n.*"/>
       <cat-item lemma="octubre" tags="n.*"/>
       <cat-item lemma="novembre" tags="n.*"/>
       <cat-item lemma="desembre" tags="n.*"/>
    </def-cat>
    <def-cat n="num_roma"> <!-- algun error fa que els lemes s'hagin de posar en minúscules, o bé no es reconeixen -->
       <cat-item lemma="i" tags="num.*"/>
       <cat-item lemma="ii" tags="num.*"/>
       <cat-item lemma="iii" tags="num.*"/>
       <cat-item lemma="iv" tags="num.*"/>
       <cat-item lemma="v" tags="num.*"/>
       <cat-item lemma="vi" tags="num.*"/>
       <cat-item lemma="vii" tags="num.*"/>
       <cat-item lemma="viii" tags="num.*"/>
       <cat-item lemma="ix" tags="num.*"/>
       <cat-item lemma="x" tags="num.*"/>
       <cat-item lemma="xi" tags="num.*"/>
       <cat-item lemma="xii" tags="num.*"/>
       <cat-item lemma="xiii" tags="num.*"/>
       <cat-item lemma="xiv" tags="num.*"/>
       <cat-item lemma="xv" tags="num.*"/>
       <cat-item lemma="xvi" tags="num.*"/>
       <cat-item lemma="xvii" tags="num.*"/>
       <cat-item lemma="xviii" tags="num.*"/>
       <cat-item lemma="xix" tags="num.*"/>
       <cat-item lemma="xx" tags="num.*"/>
       <cat-item lemma="xxi" tags="num.*"/>
       <cat-item lemma="xxi" tags="num.*"/>
       <cat-item lemma="xxii" tags="num.*"/>
       <cat-item lemma="xxiii" tags="num.*"/>
       <cat-item lemma="xxiv" tags="num.*"/>
       <cat-item lemma="xxv" tags="num.*"/>
       <cat-item lemma="xxvi" tags="num.*"/>
       <cat-item lemma="xxvii" tags="num.*"/>
       <cat-item lemma="xxviii" tags="num.*"/>
       <cat-item lemma="xxix" tags="num.*"/>
       <cat-item lemma="xxx" tags="num.*"/>
    </def-cat>
    <def-cat n="segle_sg">
       <cat-item lemma="segle" tags="n.m.sg"/>
    </def-cat>
    <def-cat n="periode">
       <cat-item lemma="segon" tags="n.*"/>
       <cat-item lemma="minut" tags="n.*"/>
       <cat-item lemma="hora" tags="n.*"/>
       <cat-item lemma="dia" tags="n.*"/>
       <cat-item lemma="setmana" tags="n.*"/>
       <cat-item lemma="mes" tags="n.*"/>
       <cat-item lemma="any" tags="n.*"/>
       <cat-item lemma="lustre" tags="n.*"/>
       <cat-item lemma="segle" tags="n.*"/>
       <cat-item lemma="mil·lenni" tags="n.*"/>
    </def-cat>

    <def-cat n="regne_rei">
       <cat-item lemma="imperi" tags="n.*"/>
       <cat-item lemma="regne" tags="n.*"/>
       <cat-item lemma="corona" tags="n.*"/>
       <cat-item lemma="sultanat" tags="n.*"/>
       <cat-item lemma="califat" tags="n.*"/>
       <cat-item lemma="emirat" tags="n.*"/>
       <cat-item lemma="virregnat" tags="n.*"/>
       <cat-item lemma="principat" tags="n.*"/>
       <cat-item lemma="comtat" tags="n.*"/>
       <cat-item lemma="vescomtat" tags="n.*"/>
       <cat-item lemma="ducat" tags="n.*"/>
       <cat-item lemma="gran ducat" tags="n.*"/>
       <cat-item lemma="arxiducat" tags="n.*"/>
       <cat-item lemma="marquesat" tags="n.*"/>
       <cat-item lemma="marcgravinat" tags="n.*"/>
       <cat-item lemma="baronia" tags="n.*"/>
       <cat-item lemma="voivodat" tags="n.*"/>
       <cat-item lemma="bisbat" tags="n.*"/>
       <cat-item lemma="arquebisbat" tags="n.*"/>
       <cat-item lemma="casal" tags="n.*"/>
       <cat-item lemma="papa" tags="n.*"/>
       <cat-item lemma="patriarca" tags="n.*"/>
       <cat-item lemma="bisbe" tags="n.*"/>
       <cat-item lemma="arquebisbe" tags="n.*"/>
       <cat-item lemma="apòstol" tags="n.*"/>
       <cat-item lemma="emperador" tags="n.*"/>
       <cat-item lemma="rei" tags="n.*"/>
       <cat-item lemma="tsar" tags="n.*"/>
       <cat-item lemma="sultà" tags="n.*"/>
       <cat-item lemma="califa" tags="n.*"/>
       <cat-item lemma="emir" tags="n.*"/>
       <cat-item lemma="virrei" tags="n.*"/>
       <cat-item lemma="regent" tags="n.*"/>
       <cat-item lemma="príncep" tags="n.*"/>
       <cat-item lemma="infant" tags="n.*"/>
       <cat-item lemma="delfí" tags="n.*"/>
       <cat-item lemma="comte" tags="n.*"/>
       <cat-item lemma="vescomte" tags="n.*"/>
       <cat-item lemma="duc" tags="n.*"/>
       <cat-item lemma="arxiduc" tags="n.*"/>
       <cat-item lemma="marquès" tags="n.*"/>
       <cat-item lemma="marcgravi" tags="n.*"/>
       <cat-item lemma="marcgravina" tags="n.*"/>
       <cat-item lemma="baró" tags="n.*"/>
       <cat-item lemma="voivoda" tags="n.*"/>
       <cat-item lemma="elector" tags="n.*"/>
    </def-cat>

    <def-cat n="cm">
       <cat-item tags="cm"/>
    </def-cat>

    <def-cat n="sent">
       <cat-item lemma="." tags="sent"/>
    </def-cat>
    <def-cat n="final_sent">
       <cat-item lemma="." tags="sent"/>
       <cat-item lemma="?" tags="sent"/>
       <cat-item lemma="!" tags="sent"/>
       <cat-item lemma=":" tags="sent"/>
    </def-cat>
  </section-def-cats>

  <section-def-attrs>
    <def-attr n="a_categ">
      <attr-item tags="n"/>
      <attr-item tags="adj"/>
      <attr-item tags="adv"/>
      <attr-item tags="np"/>
      <attr-item tags="pr"/>
      <attr-item tags="prn"/>
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/>
      <attr-item tags="cnjadv"/>
      <attr-item tags="cnjcoo"/>
      <attr-item tags="cnjsub"/>
      <attr-item tags="ij"/>
    </def-attr>

    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
      <attr-item tags="n.unc"/>
      <attr-item tags="np.top"/>
      <attr-item tags="np.hyd"/>
      <attr-item tags="np.ant"/>
      <attr-item tags="np.cog"/>
      <attr-item tags="np.loc"/>
      <attr-item tags="np.al"/>
      <attr-item tags="np.org"/>
    </def-attr>

    <def-attr n="a_adj">
      <attr-item tags="adj"/>
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.ord"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj.qnt"/>
      <attr-item tags="adj.sup"/>
      <attr-item tags="adj.ind.sup"/>
      <attr-item tags="det.ind"/> <!-- poco / poc -->
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbser.pp"/>
    </def-attr>

    <def-attr n="a_det">          
      <attr-item tags="det.def"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.pos"/>
      <attr-item tags="predet"/>
    </def-attr>

    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>

    <def-attr n="gen_sense_mf">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>

    <def-attr n="gen_mf">
      <attr-item tags="mf"/>
    </def-attr>

    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>

    <def-attr n="nbr_sense_sp">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="ND"/>
    </def-attr>

    <def-attr n="nbr_sp">
      <attr-item tags="sp"/>
    </def-attr>

    <def-attr n="a_num">
      <attr-item tags="num"/>
      <attr-item tags="num.percent"/>
    </def-attr>

    <def-attr n="tipus_prn">
      <attr-item tags="prn.tn.pos"/>
      <attr-item tags="prn.tn.ref"/>
      <attr-item tags="prn.tn"/>
      <attr-item tags="prn.itg"/>
      <attr-item tags="prn.pro"/>
      <attr-item tags="prn.pro.adv"/>
      <attr-item tags="prn.pro.ref"/>
      <attr-item tags="prn.enc"/>
      <attr-item tags="prn.enc.adv"/>
      <attr-item tags="prn.enc.ref"/>
      <attr-item tags="prn.dem"/>
      <attr-item tags="prn.ind"/>
      <attr-item tags="prn.pos"/>
    </def-attr>

    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/>
      <attr-item tags="vaux"/>
    </def-attr>

   <def-attr n="a_pp">
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbser.pp"/>
      <attr-item tags="vbmod.pp"/>
      <attr-item tags="vaux.pp"/>
      <attr-item tags="vbhaver.pp"/>
    </def-attr>

   <def-attr n="pers">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>

   <def-attr n="temps">
      <attr-item tags="cni"/>
      <attr-item tags="fts"/>
      <attr-item tags="fti"/>  
      <attr-item tags="ifi"/>
      <attr-item tags="imp"/>
      <attr-item tags="pii"/>
      <attr-item tags="pis"/>
      <attr-item tags="pri"/>
      <attr-item tags="prs"/>
      <attr-item tags="pp"/><!-- ? -->
      <attr-item tags="ger"/><!-- ? -->
      <attr-item tags="inf"/><!-- ? -->
    </def-attr>

   <def-attr n="a_np_acr">
     <attr-item tags="np"/>
     <attr-item tags="acr"/>
   </def-attr>
  </section-def-attrs>

  <section-def-vars>
    <def-var n="caseFirstWord"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="EOS"/>
    <def-var n="genero" v="&lt;m&gt;"/>
    <def-var n="numero" v="&lt;sg&gt;"/>
    <def-var n="numero_sl" v="&lt;sg&gt;"/>
    <def-var n="genero_sl" v="&lt;m&gt;"/>
    <def-var n="numero_aux" v="&lt;sg&gt;"/>
    <def-var n="genero_aux" v="&lt;m&gt;"/>
    <def-var n="lemma"/>
    <def-var n="aux1"/>
    <def-var n="aux2"/>
  </section-def-vars>

  <section-def-lists>
    <def-list n="verbs_estat">
      <list-item v="estar"/>
      <list-item v="ser"/>
      <list-item v="quedar"/>
     </def-list>

    <def-list n="verbs_reflexius">
      <list-item v="agenollar"/>
      <list-item v="banyar"/>
      <list-item v="dutxar"/>
      <list-item v="implicar"/>
      <list-item v="pentinar"/>
      <list-item v="rentar"/>
      <list-item v="saludar"/>
    </def-list>

    <def-list n="vbambser">
      <list-item v="accorrere"/>
      <list-item v="addivenire"/>
      <list-item v="affiorare"/>
      <list-item v="allibire"/>
      <list-item v="ammattire"/>
      <list-item v="ammuffire"/>
      <list-item v="andare"/>
      <list-item v="apparire"/>
      <list-item v="arrivare"/>
      <list-item v="arrossire"/>
      <list-item v="assurgere"/>
      <list-item v="avvenire"/>
      <list-item v="avvizzire"/>
      <list-item v="balenare"/>
      <list-item v="bastare"/>
      <list-item v="cadere"/>
      <list-item v="capitare"/>
      <list-item v="cascare"/>
      <list-item v="comparire"/>
      <list-item v="costare"/>
      <list-item v="crollare"/>
      <list-item v="decadere"/>
      <list-item v="decedere"/>
      <list-item v="decorrere"/>
      <list-item v="decrescere"/>
      <list-item v="defungere"/>
      <list-item v="dimagrire"/>
      <list-item v="dipendere"/>
      <list-item v="dispiacere"/>
      <list-item v="divenire"/>
      <list-item v="diventare"/>
      <list-item v="durare"/>
      <list-item v="emergere"/>
      <list-item v="entrare"/>
      <list-item v="esistere"/>
      <list-item v="essere"/>
      <list-item v="giacere"/>
      <list-item v="giungere"/>
      <list-item v="implodere"/>
      <list-item v="incorrere"/>
      <list-item v="insorgere"/>
      <list-item v="insorgere"/>
      <list-item v="intervenire"/>
      <list-item v="morire"/>
      <list-item v="nascere"/>
      <list-item v="occorrere"/>
      <list-item v="parere"/>
      <list-item v="partire"/>
      <list-item v="permanere"/>
      <list-item v="piacere"/>
      <list-item v="provenire"/>
      <list-item v="restare"/>
      <list-item v="ricadere"/>
      <list-item v="rimanere"/>
      <list-item v="risorgere"/>
      <list-item v="risultare"/>
      <list-item v="ritornare"/>
      <list-item v="riuscire"/>
      <list-item v="sbucare"/>
      <list-item v="scadere"/>
      <list-item v="scappare"/>
      <list-item v="scomparire"/>
      <list-item v="sembrare"/>
      <list-item v="sfuggire"/>
      <list-item v="sparire"/>
      <list-item v="sopraggiungere"/>
      <list-item v="sopravvenire"/>
      <list-item v="sorgere"/>
      <list-item v="sovvenire"/>
      <list-item v="spiacere"/>
      <list-item v="stare"/>
      <list-item v="sussistere"/>
      <list-item v="svanire"/>
      <list-item v="svenire"/>
      <list-item v="tornare"/>
      <list-item v="uscire"/>
      <list-item v="valere"/>
      <list-item v="venire"/>

      <list-item v="accedere"/>
      <list-item v="allunare"/>
      <list-item v="ammarare"/>
      <list-item v="annottare"/>
      <list-item v="appartenere"/>
      <list-item v="approdare"/>
      <list-item v="arretrare"/>
      <list-item v="assomigliare"/>
      <list-item v="attecchire"/>
      <list-item v="atterrare"/>
      <list-item v="brillare"/>
      <list-item v="calzare"/>
      <list-item v="campare"/>
      <list-item v="coincidere"/>
      <list-item v="combaciare"/>
      <list-item v="confluire"/>
      <list-item v="convivere"/>
      <list-item v="culminare"/>
      <list-item v="debordare"/>
      <list-item v="decollare"/>
      <list-item v="defluire"/>
      <list-item v="degenerare"/>
      <list-item v="deragliare"/>
      <list-item v="dilagare"/>
      <list-item v="diluviare"/>
      <list-item v="emigrare"/>
      <list-item v="equivalere"/>
      <list-item v="espatriare"/>
      <list-item v="figurare"/>
      <list-item v="fioccare"/>
      <list-item v="garbare"/>
      <list-item v="germinare"/>
      <list-item v="germogliare"/>
      <list-item v="grandinare"/>
      <list-item v="incespicare"/>
      <list-item v="inciampare"/>
      <list-item v="indietreggiare"/>
      <list-item v="inorridire"/>
      <list-item v="lampeggiare"/>
      <list-item v="luccicare"/>
      <list-item v="marcire"/>
      <list-item v="maturare"/>
      <list-item v="migliorare"/>
      <list-item v="naufragare"/>
      <list-item v="nevicare"/>
      <list-item v="piovere"/>
      <list-item v="prevalere"/>
      <list-item v="procedere"/>
      <list-item v="rabbrividire"/>
      <list-item v="rimpatriare"/>
      <list-item v="risaltare"/>
      <list-item v="risuonare"/>
      <list-item v="scivolare"/>
      <list-item v="somigliare"/>
      <list-item v="sventolare"/>
      <list-item v="tramontare"/>
      <list-item v="vivere"/>
      <list-item v="zampillare"/>

      <list-item v="accelerare"/>
      <list-item v="accrescere"/>
      <list-item v="affievolire"/>
      <list-item v="affogare"/>
      <list-item v="affondare"/>
      <list-item v="agghiacciare"/>
      <list-item v="ammutolire"/>
      <list-item v="annegare"/>
      <list-item v="annerire"/>
      <list-item v="ardere"/>
      <list-item v="arretrare"/>
      <list-item v="arricchire"/>
      <list-item v="arrugginire"/>
      <list-item v="asfissiare"/>
      <list-item v="aumentare"/>
      <list-item v="avanzare"/>
      <list-item v="azzittire"/>
      <list-item v="bruciare"/>
      <list-item v="calare"/>
      <list-item v="calzare"/>
      <list-item v="cambiare"/>
      <list-item v="centuplicare"/>
      <list-item v="cessare"/>
      <list-item v="cicatrizzare"/>
      <list-item v="colare"/>
      <list-item v="cominciare"/>
      <list-item v="continuare"/>
      <list-item v="convenire"/>
      <list-item v="correre"/>
      <list-item v="crepare"/>
      <list-item v="crescere"/>
      <list-item v="declinare"/>
      <list-item v="derivare"/>
      <list-item v="deviare"/>
      <list-item v="diminuire"/>
      <list-item v="discendere"/>
      <list-item v="evadere"/>
      <list-item v="esplodere"/>
      <list-item v="fallire"/>
      <list-item v="finire"/>
      <list-item v="fuggire"/>
      <list-item v="gelare"/>
      <list-item v="guarire"/>
      <list-item v="importare"/>
      <list-item v="ingrassare"/>
      <list-item v="invecchiare"/>
      <list-item v="mancare"/>
      <list-item v="maturare"/>
      <list-item v="migliorare"/>
      <list-item v="montare"/>
      <list-item v="mutare"/>
      <list-item v="passare"/>
      <list-item v="peggiorare"/>
      <list-item v="pesare"/>
      <list-item v="resuscitare"/>
      <list-item v="rincarare"/>
      <list-item v="ringiovanire"/>
      <list-item v="salire"/>
      <list-item v="saltare"/>
      <list-item v="sbarcare"/>
      <list-item v="scattare"/>
      <list-item v="scendere"/>
      <list-item v="schizzare"/>
      <list-item v="scorrere"/>
      <list-item v="seguire"/>
      <list-item v="servire"/>
      <list-item v="sfumare"/>
      <list-item v="suonare"/>
      <list-item v="toccare"/>
      <list-item v="trascorrere"/>
      <list-item v="variare"/>
    </def-list>

    <def-list n="familiars">
      <list-item v="fill"/>
      <list-item v="pare"/>
      <list-item v="mare"/>
      <list-item v="papa"/>
      <list-item v="mama"/>
      <list-item v="avi"/>
      <list-item v="iaia"/>
      <list-item v="besavi"/>
      <list-item v="oncle"/>
    </def-list>

    <def-list n="paisos_regions"> <!-- per a afegir un article si no el porten -->
      <list-item v="Europa"/>
      <list-item v="Asia"/>
      <list-item v="Africa"/>
      <list-item v="Africa del Sud"/>
      <list-item v="America"/>
      <list-item v="America Centrale"/>
      <list-item v="America del Nord"/>
      <list-item v="America del Sud"/>
      <list-item v="Nord America"/>
      <list-item v="Nord-America"/>
      <list-item v="Sud America"/>
      <list-item v="Sud-America"/>
      <list-item v="Oceania"/>
      <list-item v="Scandinavia"/>
      <list-item v="Afganistan"/>
      <list-item v="Algeria"/>
      <list-item v="Angola"/>
      <list-item v="Antigua e Barbuda"/>
      <list-item v="Arabia"/>
      <list-item v="Arabia Saudita"/>
      <list-item v="Argentina"/>
      <list-item v="Armenia"/>
      <list-item v="Australia"/>
      <list-item v="Austria"/>
      <list-item v="Azerbaigian"/>
      <list-item v="Bahamas"/>
      <list-item v="Bahrain"/>
      <list-item v="Bangladesh"/>
      <list-item v="Barbados"/>
      <list-item v="Belgio"/>
      <list-item v="Belize"/>
      <list-item v="Benin"/>
      <list-item v="Bhutan"/>
      <list-item v="Bielorussia"/>
      <list-item v="Bolivia"/>
      <list-item v="Borneo"/>
      <list-item v="Botswana"/>
      <list-item v="Brasile"/>
      <list-item v="Gran Bretagna"/>
      <list-item v="Brunei"/>
      <list-item v="Bulgaria"/>
      <list-item v="Burkina Faso"/>
      <list-item v="Burundi"/>
      <list-item v="Capo Verde"/>
      <list-item v="Nuova Caledonia"/>
      <list-item v="Camerun"/>
      <list-item v="Canada"/>
      <list-item v="Sulawesi"/>
      <list-item v="Ciad"/>
      <list-item v="Colombia"/>
      <list-item v="Comore"/>
      <list-item v="Congo"/>
      <list-item v="Corea"/>
      <list-item v="Corea del Nord"/>
      <list-item v="Corea del Sud"/>
      <list-item v="Costa d'Avorio"/>
      <list-item v="Costa Rica"/>
      <list-item v="Cuba"/>
      <list-item v="Danimarca"/>
      <list-item v="Dominica"/>
      <list-item v="Ecuador"/>
      <list-item v="Egitto"/>
      <list-item v="Ellesmere"/>
<!--      <list-item v="El Salvador"/> -->
      <list-item v="Eritrea"/>
      <list-item v="Estonia"/>
      <list-item v="Etiopia"/>
      <list-item v="Fær Øer"/>
      <list-item v="Filippine"/>
      <list-item v="Finlandia"/>
      <list-item v="Francia"/>
      <list-item v="Gabon"/>
      <list-item v="Gambia"/>
      <list-item v="Georgia"/>
      <list-item v="Germania"/>
      <list-item v="Ghana"/>
      <list-item v="Nuova Guinea"/>
      <list-item v="Giamaica"/>
      <list-item v="Giappone"/>
      <list-item v="Giava"/>
      <list-item v="Gibuti"/>
      <list-item v="Giordania"/>
      <list-item v="Grenada"/>
      <list-item v="Grecia"/>
      <list-item v="Groenlandia"/>
      <list-item v="Guadalupa"/>
      <list-item v="Guyana francese"/>
      <list-item v="Guam"/>
      <list-item v="Guatemala"/>
      <list-item v="Guinea"/>
      <list-item v="Guinea Bissau"/>
      <list-item v="Guinea Equatoriale"/>
      <list-item v="Guyana"/>
      <list-item v="Haiti"/>
      <list-item v="Honduras"/>
      <list-item v="Indonesia"/>
      <list-item v="Iran"/>
      <list-item v="Iraq"/>
      <list-item v="Irlanda"/>
      <list-item v="Irlanda del Nord"/>
      <list-item v="Islanda"/>
      <list-item v="Spagna"/>
      <list-item v="Israele"/>
      <list-item v="Svezia"/>
      <list-item v="Svizzera"/>
      <list-item v="Italia"/>
      <list-item v="Yemen"/>
      <list-item v="Kazakistan"/>
      <list-item v="Kenya"/>
      <list-item v="Kirghizistan"/>
      <list-item v="Kiribati"/>
      <list-item v="Kuwait"/>
      <list-item v="Laos"/>
      <list-item v="Lesotho"/>
      <list-item v="Lettonia"/>
      <list-item v="Libano"/>
      <list-item v="Liberia"/>
      <list-item v="Libia"/>
      <list-item v="Lituania"/>
      <list-item v="Lussemburgo"/>
      <list-item v="Luzon"/>
      <list-item v="Macedonia"/>
      <list-item v="Macedonia del Nord"/>
      <list-item v="Madagascar"/>
      <list-item v="Malesia"/>
      <list-item v="Malawi"/>
      <list-item v="Mali"/>
      <list-item v="Malpelo"/>
      <list-item v="Malta"/>
      <list-item v="Marocco"/>
      <list-item v="Mauritania"/>
      <list-item v="Mauritius"/>
      <list-item v="Melville"/>
      <list-item v="Messico"/>
      <list-item v="Mindanao"/>
      <list-item v="Mongolia"/>
      <list-item v="Mozambico"/>
      <list-item v="Myanmar"/>
      <list-item v="Birmania"/>
      <list-item v="Cambogia"/>
      <list-item v="Namibia"/>
      <list-item v="Nauru"/>
      <list-item v="Nepal"/>
      <list-item v="Nicaragua"/>
      <list-item v="Niger"/>
      <list-item v="Nigeria"/>
      <list-item v="Norfolk"/>
      <list-item v="Norvegia"/>
      <list-item v="Olanda"/>
      <list-item v="Oman"/>
      <list-item v="Pakistan"/>
      <list-item v="Palestina"/>
      <list-item v="Panama"/>
      <list-item v="Papua"/>
      <list-item v="Paraguay"/>
      <list-item v="Perù"/>
      <list-item v="Polonia"/>
      <list-item v="Portogallo"/>
      <list-item v="Puerto Rico"/>
      <list-item v="Qatar"/>
      <list-item v="Romania"/>
      <list-item v="Ruanda"/>
      <list-item v="Russia"/>
      <list-item v="Siberia"/>
      <list-item v="Sahara Occidentale"/>
      <list-item v="Santa Lucia"/>
      <list-item v="São Tomé e Príncipe"/>
      <list-item v="Saint Vincent e Grenadine"/>
      <list-item v="Senegal"/>
      <list-item v="Serbia"/>
      <list-item v="Nuova Siberia"/>
      <list-item v="Sierra Leone"/>
      <list-item v="Singapore"/>
      <list-item v="Siria"/>
      <list-item v="Somalia"/>
      <list-item v="Somerset"/>
      <list-item v="Southampton"/>
      <list-item v="Sri Lanka"/>
      <list-item v="Saint-Pierre e Miquelon"/>
      <list-item v="Sudan"/>
      <list-item v="Sumatra"/>
      <list-item v="Suriname"/>
      <list-item v="Swaziland"/>
      <list-item v="Tagikistan"/>
      <list-item v="Tailandia"/>
      <list-item v="Taiwan"/>
      <list-item v="Tanzania"/>
      <list-item v="Tasmania"/>
      <list-item v="Terranova"/>
      <list-item v="Timor"/>
      <list-item v="Togo "/>
      <list-item v="Trinidad e Tobago"/>
      <list-item v="Tunisia"/>
      <list-item v="Turchia"/>
      <list-item v="Turkmenistan"/>
      <list-item v="Tuvalu"/>
      <list-item v="Cile"/>
      <list-item v="Cina"/>
      <list-item v="Cipro"/>
      <list-item v="Ucraina"/>
      <list-item v="E.a.u."/>
      <list-item v="Uganda"/>
      <list-item v="Ungheria"/>
      <list-item v="Uruguay"/>
      <list-item v="Uzbekistan"/>
      <list-item v="Vanuatu"/>
      <list-item v="Venezuela"/>
      <list-item v="Vietnam"/>
      <list-item v="Zambia"/>
      <list-item v="Nuova Zelanda"/>
      <list-item v="Zimbawe"/>
      <list-item v="Piemonte"/>
      <list-item v="Liguria"/>
      <list-item v="Lombardia"/>
      <list-item v="Trentino-Alto Adige"/>
      <list-item v="Trentino"/>
      <list-item v="Veneto"/>
      <list-item v="Friuli"/>
      <list-item v="Friuli-Venezia Giulia"/>
      <list-item v="Emilia-Romagna"/>
      <list-item v="Emilia"/>
      <list-item v="Romagna"/>
      <list-item v="Toscana"/>
      <list-item v="Umbria"/>
      <list-item v="Lazio"/>
      <list-item v="Abruzzo"/>
      <list-item v="Molise"/>
      <list-item v="Campania"/>
      <list-item v="Basilicata"/>
      <list-item v="Puglia"/>
      <list-item v="Calabria"/>
      <list-item v="Sicilia"/>
      <list-item v="Sardegna"/>
      <list-item v="Catalogna"/>
      <list-item v="Catalogna del Nord"/>
      <list-item v="Aragona"/>
      <list-item v="Castiglia"/>
      <list-item v="Andalusia"/>
      <list-item v="Galizia"/>
      <list-item v="Biscaglia"/>
      <list-item v="Bretagna"/>
      <list-item v="Occitania"/>
      <list-item v="Linguadoca"/>
      <list-item v="Provenza"/>
      <list-item v="Aquitania"/>
      <list-item v="Guascogna"/>
      <list-item v="Normandia"/>
      <list-item v="Corsica"/>
      <list-item v="Rossiglione"/>
      <list-item v="Inghilterra"/>
      <list-item v="Scozia"/>
      <list-item v="Galles"/>
      <list-item v="Devon"/>
      <list-item v="Cornovaglia"/>
      <list-item v="Fiandra"/>
      <list-item v="Fiandre"/>
      <list-item v="Frisia"/>
      <list-item v="Drenthe"/>
      <list-item v="Zelanda"/>
      <list-item v="Baden-Württemberg"/>
      <list-item v="Baviera"/>
      <list-item v="Brandeburgo"/>
      <list-item v="Renania"/>
      <list-item v="Palatinato"/>
      <list-item v="Renania-Palatinato"/>
      <list-item v="Vestfalia"/>
      <list-item v="Renania Settentrionale-Vestfalia"/>
      <list-item v="Sassonia"/>
      <list-item v="Schleswig-Holstein"/>
      <list-item v="Boemia"/>
      <list-item v="Moravia"/>
      <list-item v="Slesia"/>
      <list-item v="Crimea"/>
      <list-item v="Tibet"/>
      <list-item v="Alabama"/>
      <list-item v="Alaska"/>
      <list-item v="Arizona"/>
      <list-item v="California"/>
      <list-item v="Carolina del Nord"/>
      <list-item v="Carolina del Sud"/>
      <list-item v="Connecticut"/>
      <list-item v="Dakota del Nord"/>
      <list-item v="Dakota del Sud"/>
      <list-item v="Idaho"/>
      <list-item v="Illinois"/>
      <list-item v="Indiana"/>
      <list-item v="Kansas"/>
      <list-item v="Kentucky"/>
      <list-item v="Louisiana"/>
      <list-item v="Massachusetts"/>
      <list-item v="Michigan"/>
      <list-item v="Minnesota"/>
      <list-item v="Missouri"/>
      <list-item v="Montana"/>
      <list-item v="Nevada"/>
      <list-item v="New England"/>
      <list-item v="New Hampshire"/>
      <list-item v="New Jersey"/>
      <list-item v="Oklahoma"/>
      <list-item v="Ohio"/>
      <list-item v="Texas"/>
      <list-item v="Utah"/>
      <list-item v="Wyoming"/>
      <list-item v="Wisconsin"/>
      <list-item v="Alberta"/>
      <list-item v="Labrador"/>
      <list-item v="Manitoba"/>
      <list-item v="Ontario"/>
      <list-item v="Quebec"/>
      <list-item v="Saskatchewan"/>
      <list-item v="Terranova"/>
      <list-item v="Rio Grande do Sul"/>
      <list-item v="Polinesia"/>
      <list-item v="Melanesia"/>
      <list-item v="Micronesia"/>
      <list-item v="Prussia"/>
      <list-item v="Persia"/>
      <list-item v="Mesopotamia"/>
      <list-item v="Babilonia"/>
      <list-item v="Caldea"/>
      <list-item v="Giudea"/>
      <list-item v="Cecoslovacchia"/>
      <list-item v="Jugoslavia"/>
    </def-list>
  </section-def-lists>

  <section-def-macros>

    <def-macro n="firstWord" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="a_np_acr"/>
              <lit v=""/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal> 
                  <var n="EOS"/>
                  <lit v="true"/>
                </equal> 
              </test>
              <modify-case>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="aa"/>
              </modify-case>
              <let>
                <var n="caseFirstWord"/>
                <lit v="Aa"/>
              </let>
            </when>
            <otherwise> 
              <let>
                <var n="caseFirstWord"/>
                <lit v="aa"/>
              </let>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <let>
            <var n="caseFirstWord"/>
            <lit v="aa"/>
          </let>
        </otherwise>
      </choose>
      <let>
        <var n="EOS"/>
        <lit v="false"/>
      </let>
    </def-macro>


    <def-macro n="f_bcond" npar="2"><!--Per mirar si el blanc cont?o no format. Cal posar aquesta funci?en les regles en qu?desaparegui alguna paraula, per tal de decidir si el blanc de la paraula eliminada s'ha d'eliminar o conservar. Si cont?format cal conservar-la, si no en cont?cal eliminar-la perqu?no apareguin dos espais seguits. -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <b pos="1"/>
                <lit v=" "/>
              </equal>
            </not>
          </test>
          <out>
            <b pos="1"/>
          </out>
        </when>                 
      </choose>
    </def-macro>


    <def-macro n="f_concord1" npar="1">
      <choose>
        <!--To determine value of variables of gender and
            number and propagate to other rules.  Variables are
            not used again in this rule -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="mf"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="mf"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <!-- If word has GD or ND, we try to assign the
                 gender or number of the previous rule. If there is no
                 value for the gender or number variable from previous
                 rules, gender will be masculine and number singular.-->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genero"/>
                  <lit-tag v="f"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="f"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </let>
              <let>
                <var n="genero"/>
                <lit-tag v="m"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="numero"/>
                  <lit-tag v="pl"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="pl"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sg"/>
              </let>
              <let>
                <var n="numero"/>
                <lit-tag v="sg"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
    </def-macro>
    

    <def-macro n="f_concord2" npar="2"> <!-- p1: nom, p2: num (si n'hi ha un) -->

      <!-- pedaç per a coses com "200.000 unità" i "tre unità" -->
      <!--
        ^200.000<num>/200.000<num>$ ^unità<n><f><sp>/unitat<n><f><ND>$
        ^tre<num><mf><sp>/tres<num><mf><sp>$ ^unità<n><f><sp>/unitat<n><f><ND>$^
      -->
      <choose>
        <when>
          <test>
            <and>
              <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="ND"/></equal>
              <equal><clip pos="2" side="tl" part="a_num"/><lit-tag v="num"/></equal>
	      <or>
                <equal><clip pos="2" side="tl" part="nbr"/><lit-tag v="sp"/></equal>
                <equal><clip pos="2" side="tl" part="nbr"/><lit v=""/></equal>
              </or>
            </and>
          </test>
          <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="pl"/></let>
          <let><var n="numero"/><lit-tag v="pl"/></let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <!-- do the main and second parameter gender agree?-->
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <!-- do the main and second parameter number agree?-->
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
          <!-- there is gender and number agreement-->
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
          <!-- there isn't gender and number agreement-->
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <!-- Propagate the main parameter gender if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <!-- Propagate the main parameter number if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <!-- Which is the rule general gender? -->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <or>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </and>
              <and>
                <equal>
                  <clip pos="2" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </and>
            </or>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="GD"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>

      </choose>
      <choose>
        <when>
          <test>
            <!-- Which is the rule general number? -->
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="ND"/>
          </let>
        </when>
        <!--       <otherwise>
             <let>
             <var n="genero"/>
             <lit-tag v="m"/>
             </let>
             </otherwise>-->
      </choose>
      <!-- Determine gender and number value if they are undetermined -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="f_concord3" npar="3"> <!-- p1: nom, p2: num (si n'hi ha un) -->

      <!-- pedaç per a coses com "200.000 unità" i "tre unità" -->
      <!--
        ^200.000<num>/200.000<num>$ ^unità<n><f><sp>/unitat<n><f><ND>$
        ^tre<num><mf><sp>/tres<num><mf><sp>$ ^unità<n><f><sp>/unitat<n><f><ND>$^
      -->
      <choose>
        <when>
          <test>
            <and>
              <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="ND"/></equal>
              <equal><clip pos="2" side="tl" part="a_num"/><lit-tag v="num"/></equal>
	      <or>
                <equal><clip pos="2" side="tl" part="nbr"/><lit-tag v="sp"/></equal>
                <equal><clip pos="2" side="tl" part="nbr"/><lit v=""/></equal>
              </or>
            </and>
          </test>
          <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="pl"/></let>
          <let><var n="numero"/><lit-tag v="pl"/></let>
        </when>
      </choose>

      <choose>
        <!-- Look whether in source language there is concordance between first and second element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <!-- Look whether in source language there is concordance between second and third element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <!-- Propagate the main parameter gender if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <!-- Propagate the main parameter number if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <!-- Determine the rule general gender. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="3" side="sl" part="gen"/>
          </let>
        </when>
        
        <!--                        <when>
            <test>
            <or>
            <and>
            <equal>
            <clip pos="1" side="tl" part="gen"/>
            <lit-tag v="GD"/>
            </equal>
            <equal>
            <clip pos="2" side="tl" part="gen"/>
            <lit-tag v="GD"/>
            </equal>
            <equal>
            <clip pos="3" side="tl" part="gen"/>
            <lit-tag v="GD"/>
            </equal>
            </and>
            </test>
            <let>
            <var n="genero"/>
            <lit-tag v="GD"/>
            </let>
            </when>-->
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="GD"/>
          </let>
        </otherwise>
      </choose>

      <choose>
        <!-- Determine the rule general number. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="ND"/>
          </let>
        </when>
        
      </choose>
      <choose>
        <!-- Assign values to GD and ND -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>
    
    <def-macro n="f_concord4" npar="4">
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concTercero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concTercero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="3" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="4" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="4" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="GD"/>
          </let>
        </otherwise>
        <!--                                <when>
            <test>
            <and>
            <equal>
            <clip pos="1" side="tl" part="gen"/>
            <lit-tag v="GD"/>
            </equal>
            <equal>
            <clip pos="2" side="tl" part="gen"/>
            <lit-tag v="GD"/>
            </equal>
            <equal>
            <clip pos="3" side="tl" part="gen"/>
            <lit-tag v="GD"/>
            </equal>
            <equal>
            <clip pos="4" side="tl" part="gen"/>
            <lit-tag v="GD"/>
            </equal>
            </and>
            </test>
            <let>
            <var n="genero"/>
            <lit-tag v="GD"/>
            </let>
            </when>-->
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        

        <!--<when>
            <test>
            <and>
            <equal>
            <clip pos="1" side="tl" part="nbr"/>
            <lit-tag v="ND"/>
            </equal>
            <equal>
            <clip pos="2" side="tl" part="nbr"/>
            <lit-tag v="ND"/>
            </equal>
            <equal>
            <clip pos="3" side="tl" part="nbr"/>
            <lit-tag v="ND"/>
            </equal>
            <equal>
            <clip pos="4" side="tl" part="nbr"/>
            <lit-tag v="ND"/>
            </equal>
            </and>
            </test>
            <let>
            <var n="numero"/>
            <lit-tag v="ND"/>
            </let>
            </when>-->
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="4" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="4" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
              <equal>
                <clip pos="4" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="ND"/>
          </let>
        </when>
        
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="vauxiliar" npar="2">
      <choose>
        <when>
          <test>
            <in caseless="yes"><clip pos="2" side="tl" part="lem"/><list n="vbambser"/></in>
          </test>
          <let><clip pos="1" side="tl" part="lem"/><get-case-from pos="1"><lit v="essere"/></get-case-from></let>
          <let><clip pos="1" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
          <choose>
            <when>
              <test>
                <or>
                  <equal><var n="genero"/><lit-tag v="m"/></equal>
                  <equal><var n="genero"/><lit-tag v="f"/></equal>
                </or>
              </test>
              <!-- suposem que el subj és l'últim sn-->
              <let><clip pos="2" side="tl" part="gen"/><var n="genero"/></let>
            </when>
            <otherwise>
              <let><clip pos="2" side="tl" part="gen"/><lit-tag v="m"/></let>
            </otherwise>
          </choose>
          <choose>
            <when>
              <test>
                <or>
                  <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></equal>
                  <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="pl"/></equal>
                </or>
              </test>
	      <!-- prenem el nombre del verb auxiliar -->
              <let><clip pos="2" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
            </when>
            <otherwise>
              <let><clip pos="2" side="tl" part="nbr"/><lit-tag v="sg"/></let>
            </otherwise>
          </choose>
        </when>
      </choose>
    </def-macro>

    <def-macro n="vauxiliar3" npar="3"> <!-- com l'anterior, però per a dos verbs auxiliar: vaig haver ant -->
      <call-macro n="vauxiliar">
        <with-param pos="2"/>
        <with-param pos="3"/>
      </call-macro>
      <choose>
        <when>
          <test>
            <and>
              <equal><clip pos="2" side="tl" part="a_verb"/><lit-tag v="vbser"/></equal>
              <or>
                <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></equal>
                <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="pl"/></equal>
              </or>
            </and>
          </test>
	  <!-- prenem el nombre del verb auxiliar -->
          <let><clip pos="3" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
        </when>
      </choose>
    </def-macro>

<def-macro n="f_vaux_anar_inf" npar="2">
   <let><clip pos="2" side="tl" part="temps"/><lit-tag v="pp.m.sg"/></let>
   <choose> <!-- vaux + vlex: es canvia el vaux a essere o avere i es posa el segon en pp -->
     <when>
       <test>
         <or>
           <in caseless="yes"><clip pos="2" side="tl" part="lemh"/><list n="vbambser"/></in>
           <and>
             <equal caseless="yes"><clip pos="2" side="tl" part="lemh"/><lit v="tornare"/></equal>
             <equal><clip pos="2" side="tl" part="lemq"/><lit v=""/></equal>
           </and>
         </or>
       </test>
       <let><clip pos="1" side="tl" part="lem"/><get-case-from pos="1"><lit v="essere"/></get-case-from></let>
       <let><clip pos="1" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
       <choose>
         <when>
           <test>
             <and>
               <equal caseless="yes"><clip pos="1" side="tl" part="lem"/><lit v="essere"/></equal>
               <or>
                 <equal><var n="genero"/><lit-tag v="m"/></equal>
                 <equal><var n="genero"/><lit-tag v="f"/></equal>
               </or>
             </and>
           </test>
           <let><clip pos="2" side="tl" part="gen"/><var n="genero"/></let>
         </when>
         <otherwise>
           <let><clip pos="2" side="tl" part="gen"/><lit-tag v="m"/></let>
         </otherwise>
       </choose>
       <choose>
         <when>
           <test>
             <equal caseless="yes"><clip pos="1" side="tl" part="lem"/><lit v="essere"/></equal>
           </test>
           <let><clip pos="2" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
         </when>
         <otherwise>
           <let><clip pos="2" side="tl" part="nbr"/><lit-tag v="sg"/></let>
         </otherwise>
       </choose>
     </when>
     <otherwise>
       <let><clip pos="1" side="tl" part="lem"/><get-case-from pos="1"><lit v="avere"/></get-case-from></let>
       <let><clip pos="1" side="tl" part="a_verb"/><lit-tag v="vbhaver"/></let>
     </otherwise>
   </choose>
</def-macro>

    <def-macro n="f_chunk_tags_gen" npar="1">
      <choose>
        <when>
          <test>
            <equal><clip pos="1" side="sl" part="gen"/><lit-tag v="m"/></equal>
          </test>
          <let><var n="genero_sl"/><lit-tag v="sl_m"/></let>
        </when>
        <when>
          <test>
            <equal><clip pos="1" side="sl" part="gen"/><lit-tag v="f"/></equal>
          </test>
          <let><var n="genero_sl"/><lit-tag v="sl_f"/></let>
        </when>
        <when>
          <test>
            <equal><clip pos="1" side="sl" part="gen"/><lit-tag v="mf"/></equal>
          </test>
          <let><var n="genero_sl"/><lit-tag v="sl_mf"/></let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="f_chunk_tags_nbr" npar="1">
      <choose>
        <when>
          <test>
            <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="sg"/></equal>
          </test>
          <let><var n="numero_sl"/><lit-tag v="sl_sg"/></let>
        </when>
        <when>
          <test>
            <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
          </test>
          <let><var n="numero_sl"/><lit-tag v="sl_pl"/></let>
        </when>
        <when>
          <test>
            <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
          </test>
          <let><var n="numero_sl"/><lit-tag v="sl_sp"/></let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="f_chunk_tags" npar="1">
      <call-macro n="f_chunk_tags_gen"><with-param pos="1"/></call-macro>
      <call-macro n="f_chunk_tags_nbr"><with-param pos="1"/></call-macro>
    </def-macro>

    <def-macro n="f_chunk_tags2" npar="2">
      <let><var n="genero_sl"/><lit-tag v=""/></let>
      <call-macro n="f_chunk_tags_gen"><with-param pos="1"/></call-macro>
      <let><var n="numero_sl"/><lit-tag v=""/></let>
      <call-macro n="f_chunk_tags_nbr"><with-param pos="1"/></call-macro>
      <!-- si el primer paràmetre no assigna gènere o nombre, provem amb el següent -->
      <choose>
        <when>
          <test>
            <equal><var n="genero_sl"/><lit-tag v=""/></equal>
          </test>
          <call-macro n="f_chunk_tags_gen">
            <with-param pos="2"/>
          </call-macro>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal><var n="numero_sl"/><lit-tag v=""/></equal>
          </test>
          <call-macro n="f_chunk_tags_nbr">
            <with-param pos="2"/>
          </call-macro>
        </when>
      </choose>
    </def-macro>

<!--
    <def-macro n="f_set_sg1" npar="1">
      <choose>
        <when>
          <test>
            <and>
              <equal><var n="set_sg"/><lit v="1"/></equal>
              <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="pl"/></equal>
            </and>
          </test>
          <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></let>
        </when>
      </choose>      
      <let><var n="set_sg"/><lit v="0"/></let>
    </def-macro>      

    <def-macro n="f_set_sg2" npar="2">
      <call-macro n="f_set_sg1"><with-param pos="1"/></call-macro>
      <call-macro n="f_set_sg1"><with-param pos="2"/></call-macro>
    </def-macro>      
-->

    <def-macro n="f_salvar_gen_num" npar="0"> <!-- Per conservar les var genero i numero per restaurar-les després (per no expandir a l'esquerra aquests valors) -->
      <let><var n="genero_aux"/><var n="genero"/></let>
      <let><var n="numero_aux"/><var n="numero"/></let>
    </def-macro>


    <def-macro n="f_restaurar_gen_num" npar="0"> <!-- Per restaurar les var genero i numero i no expandir-ne a l'esquerra els valors -->
      <let><var n="genero"/><var n="genero_aux"/></let>
      <let><var n="numero"/><var n="numero_aux"/></let>
    </def-macro>

  </section-def-macros>

  <section-rules>

  <rule comment="REGLA: PRONOM"> <!--Special case, macro f_concord1 is not applicable because gender and number can not be taken from previous rules -->
      <pattern>
        <pattern-item n="prn"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="GD"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <choose> <!-- en el cas de vostè (sg) hem de mantenir la majúscula a la traducció (Lei) -->
          <when>
            <test>
              <and>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="vostè"/>
              </equal>
              <equal>
                <clip pos="1" side="sl" part="nbr"/>
                <lit-tag v="sg"/>
              </equal>
              </and>
            </test>
            <let>
              <var n="caseFirstWord"/>
              <lit v="Aa"/>
            </let>
            <out>
              <chunk name="Pronom1" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="gen"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="tags"/>
                </lu>
              </chunk>
            </out>
          </when>
          <when>
            <test>
              <equal><clip pos="1" side="sl" part="lem"/><lit v="un"/></equal>
            </test>
            <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
                  <tag><clip pos="1" side="tl" part="gen"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="tipus_prn"/>
                  <clip pos="1" side="tl" part="gen_sense_mf" link-to="4"/>
                  <clip pos="1" side="tl" part="gen_mf"/>
                  <clip pos="1" side="tl" part="nbr_sense_sp" link-to="5"/>
                  <clip pos="1" side="tl" part="nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="pronom2" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="gen"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <let>
          <var n="genero"/>
          <clip pos="1" side="tl" part="gen"/>
        </let>
        <let>
          <var n="numero"/>
          <clip pos="1" side="tl" part="nbr"/>
        </let>
      </action>
    </rule>


    <rule comment="tots nosaltres > noi tutti">
      <pattern>
        <pattern-item n="tot_prn"/>
        <pattern-item n="prnpers_subj_sense_ells"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="GD"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="pronom3" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="2" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="gen"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="2" side="tl" part="tipus_prn"/>
              <clip pos="2" side="tl" part="pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="genero"/>
          <clip pos="1" side="tl" part="gen"/>
        </let>
        <let>
          <var n="numero"/>
          <clip pos="1" side="tl" part="nbr"/>
        </let>
      </action>
    </rule>


    <rule comment="PRNPRO PRNPRO">
      <pattern>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal><clip pos="1" side="tl" part="gen"/><lit-tag v="GD"/></equal>
            </test>
            <let><clip pos="1" side="tl" part="gen"/><lit-tag v="m"/></let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="ND"/></equal>
            </test>
            <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal><clip pos="2" side="tl" part="gen"/><lit-tag v="GD"/></equal>
            </test>
            <let><clip pos="2" side="tl" part="gen"/><lit-tag v="m"/></let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal><clip pos="2" side="tl" part="nbr"/><lit-tag v="ND"/></equal>
            </test>
            <let><clip pos="2" side="tl" part="nbr"/><lit-tag v="sg"/></let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <or>
                <equal caseless="yes"><clip pos="2" side="sl" part="lem"/><lit v="es"/></equal>
                <equal caseless="yes"><clip pos="2" side="sl" part="lem"/><lit v="hi"/></equal>
              </or>
            </test>
            <choose>
              <when>
                <test>
                 <equal caseless="yes"><clip pos="2" side="sl" part="lem"/><lit v="hi"/></equal>
                </test>
                <let><clip pos="2" side="tl" part="lem"/><lit v="ce"/></let>
              </when>
            </choose>
            <out>
              <chunk name="pronom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="2" side="tl" part="tipus_prn"/></tag>
                  <tag><clip pos="2" side="tl" part="pers"/></tag>
                  <tag><clip pos="2" side="tl" part="gen"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="2" side="tl" part="lemh"/>
                  </get-case-from>
                  <clip pos="2" side="tl" part="tipus_prn"/>
                  <clip pos="2" side="tl" part="pers"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
              <b pos="1"/>
              <chunk name="pronom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="gen"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="lemh"/>
                  </get-case-from>
                  <clip pos="1" side="tl" part="tipus_prn"/>
                  <clip pos="1" side="tl" part="pers"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="pronom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="gen"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="tipus_prn"/>
                  <clip pos="1" side="tl" part="pers"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
              <b pos="1"/>
              <chunk name="pronom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="2" side="tl" part="tipus_prn"/></tag>
                  <tag><clip pos="2" side="tl" part="pers"/></tag>
                  <tag><clip pos="2" side="tl" part="gen"/></tag>
                  <tag><clip pos="2" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="tipus_prn"/>
                  <clip pos="2" side="tl" part="pers"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <let><var n="genero"/><clip pos="1" side="tl" part="gen"/></let>
        <let><var n="numero"/><clip pos="1" side="tl" part="nbr"/></let>
      </action>
    </rule>


    <rule comment="REGLA: DET (quan no acompanya res o va amb desconeguda)">
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
           </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="REGLA: NUM. Si pot ser 'm' o 'f', sortirà com a GD. Caldrà tractar-ho en interchunk o postchunk.">
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="num" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="NUM"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>   
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_num"/> 
              <clip pos="1" side="tl" part="gen" link-to="2"/>
              <clip pos="1" side="tl" part="nbr" link-to="3"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADJECTIU (quan no acompanya res o va amb desconeguda)">
      <pattern>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="REGLA: ADJ_SUP (quan no acompanya res o va amb desconeguda)">
      <pattern>
        <pattern-item n="adjsup"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <or>
                <equal><clip pos="1" side="tl" part="a_adj"/><lit-tag v="adj.sup"/></equal>
                <equal><clip pos="1" side="tl" part="a_adj"/><lit-tag v="adj.ind.sup"/></equal>
              </or>
            </test>
            <out>
              <chunk name="adjsup" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SA"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="gen_mf"/>
                  <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="adv_adj" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SA"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <lit v="molto"/>
                  <lit-tag v="adv"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="gen_mf"/>
                  <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>


    <rule comment="REGLA: TOP">
      <pattern>
        <pattern-item n="top"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in>
                <clip pos="1" side="tl" part="lem"/>
                <list n="paisos_regions"/>
              </in>
            </test>
            <out>
              <chunk name="top_potser_det" case="caseFirstWord"> <!-- aviso que potser convindrà afegir l'article a t2x -->
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="np" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: NP">
      <pattern>
        <pattern-item n="np"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="np" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM (quan no acompanya res o va amb desconeguda)">
      <pattern>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: cnjcoo">
      <pattern>
        <pattern-item n="cnjcoo"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="cnjcoo" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cnjcoo"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: cnjadv">
      <pattern>
        <pattern-item n="cnjadv"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="cnjadv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cnjadv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: cnjsub">
      <pattern>
        <pattern-item n="cnjsub"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal><clip pos="1" side="tl" part="a_categ"/><lit-tag v="pr"/></equal>
            </test>
            <out>
              <chunk name="pr" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="pr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="whole"/> 
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="cnjsub" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="cnjsub"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="whole"/> 
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: rel">
      <pattern>
        <pattern-item n="rel"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="rel" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="rel"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: pr">
      <pattern>
        <pattern-item n="pr"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: adv_preadv">
      <pattern>
        <pattern-item n="adv_preadv"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="adv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: cm">
      <pattern>
        <pattern-item n="cm"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="cm" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="cm"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- REGLES SN -->

    <!-- regles segles -->
    <rule comment="regla: segle num_roma : segle I > I secolo ">
      <pattern>
        <pattern-item n="segle_sg"/>
        <pattern-item n="num_roma"/>
      </pattern>
      <action>
        <call-macro n="f_concord1"><with-param pos="1"/></call-macro>
        <call-macro n="firstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="segle_num">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: det segle num_rom: el segle I > il I secolo I">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="segle_sg"/>
        <pattern-item n="num_roma"/>
      </pattern>
      <action>
        <call-macro n="f_concord2"><with-param pos="3"/><with-param pos="2"/></call-macro>
        <call-macro n="firstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="det_segle_num">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!--  REGLES DE COMPARACIÓ -->

    <rule comment="REGLA: més/menys adj que (més ràpid que > più veloce di)">
      <pattern>
        <pattern-item n="mes_menys"/>
        <pattern-item n="adjec"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="piu_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="2"/>
          <chunk name="di">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <lit v="di"/>
              <lit-tag v="pr"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="REGLA: més/menys adv que (més ràpid que > più veloce di)">
      <pattern>
        <pattern-item n="mes_menys"/>
        <pattern-item n="adv"/>
        <pattern-item n="que"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="piu_adv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </chunk>
          <b pos="2"/>
          <chunk name="di">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <lit v="di"/>
              <lit-tag v="pr"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <!--  FI REGLES DE COMPARACIÓ -->

    <!--  FI REGLES DE COORDINACIÓ -->

    <rule comment="REGLA: DET NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu> 
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: DET TOP: un'Italia > una Itàlia">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="top"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="det_top" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu> 
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


   <!-- REGLES PER POSAR O NO POSAR ARTICLE DAVANT DE TOPÒNIM -->

    <rule comment="REGLA: PREP TOP">
      <pattern>
        <pattern-item n="pr"/>
        <pattern-item n="top"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <in>
                <clip pos="2" side="tl" part="lem"/>
                <list n="paisos_regions"/>
              </in>
            </test>
            <out>
              <chunk name="pr_top" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SAdv"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu> 
                <b/>
                <lu>
                  <lit v="il"/>
                  <lit-tag v="det.def"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="tags"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="pr_top" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SAdv"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="tags"/>
                </lu> 
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="tags"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: ANT DE TOP">
      <pattern>
        <pattern-item n="ant"/>
        <pattern-item n="de"/>
        <pattern-item n="top"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="np" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ANT NUM DE TOP">
      <pattern>
        <pattern-item n="ant"/>
        <pattern-item n="num_roma"/>
        <pattern-item n="de"/>
        <pattern-item n="top"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="np" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: REGNE DE TOP">
      <pattern>
        <pattern-item n="regne_rei"/>
        <pattern-item n="de"/>
        <pattern-item n="top"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="nom_de_NP" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: DET REGNE DE TOP">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="regne_rei"/>
        <pattern-item n="de"/>
        <pattern-item n="top"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="det_nom_de_NP" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu> 
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

   <!-- FI REGLES PER POSAR O NO POSAR ARTICLE DAVANT DE TOPÒNIM -->

    <rule comment="REGLA: conserva 'i' en noms: Pere Mas i Garcia">
      <pattern>
        <pattern-item n="ant"/>
        <pattern-item n="cog"/>
        <pattern-item n="i"/>
        <pattern-item n="cog"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="nom_complet" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
               <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b/>
            <lu>
               <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b/>
            <lu>
               <lit v="i"/> <!-- la "i" en castellà, com a nom de lletra -->
               <lit-tag v="n"/>
               <lit-tag v="f"/>
               <lit-tag v="sp"/>
            </lu>
            <b/>
            <lu>
               <clip pos="4" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

<!--
    <rule comment="REGLA: DET AL">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="al"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="det_org" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu> 
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
-->


    <rule comment="REGLA: PREDET DET NOM">
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="predet_det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>
            </lu> 
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_det"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: DET NUM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="un"/></equal>
                <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
              </and>
            </test>
            <out>
              <chunk name="circa_num" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="circa"/>
                  </get-case-from>
                  <lit-tag v="adv"/>
                </lu> 
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="det_num" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/> 
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="gen_mf"/>
                  <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="nbr_sp"/>
                </lu> 
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: NUM NOM">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>  
          <chunk name="num_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>   
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu> 
            <b pos="1"/>
            <lu>     
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM ADJ">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>        
        <out>
          <chunk name="nom_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADJ NOM">
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ADJ NOM ADJ">
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="adj_nom_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: DET ADJ ADJ NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adv_preadv"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="4"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_adv_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="DET NUM NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="un"/></equal>
                <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
              </and>
            </test>
            <out>
              <chunk name="circa_num_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="circa"/>
                  </get-case-from>
                  <lit-tag v="adv"/>
                </lu> 
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>         
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="gen_mf"/>         
                  <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="nbr_sp"/>         
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="det_num_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="gen_mf"/>         
                  <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>         
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="gen_mf"/>         
                  <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="nbr_sp"/>         
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="només NUM NOM: només 3 km > soli 3 km">
      <pattern>
        <pattern-item n="nomes"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="adj_num_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="solo"/>
              </get-case-from>
              <lit-tag v="adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="DET NUM ADJ NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="4"/>
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="un"/></equal>
                <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
              </and>
            </test>
            <out>
              <chunk name="circa_num" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="circa"/>
                  </get-case-from>
                  <lit-tag v="adv"/>
                </lu> 
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>         
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="gen_mf"/>         
                  <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="nbr_sp"/>         
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="gen_mf"/>         
                  <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="nbr_sp"/>         
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="det_num_adj_nom" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="gen_mf"/>         
                  <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>         
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="gen_mf"/>         
                  <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="nbr_sp"/>         
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="gen_mf"/>         
                  <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="nbr_sp"/>         
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="només NUM ADJ NOM: només tres grans cases > soli 3 grandi case">
      <pattern>
        <pattern-item n="nomes"/>
        <pattern-item n="num"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="4"/>
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="adj_num_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="solo"/>
              </get-case-from>
              <lit-tag v="adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_num"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="DET NUM NOM ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="un"/></equal>
                <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
              </and>
            </test>
            <out>
              <chunk name="circa_num" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="circa"/>
                  </get-case-from>
                  <lit-tag v="adv"/>
                </lu> 
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>         
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="gen_mf"/>         
                  <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="nbr_sp"/>         
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="gen_mf"/>         
                  <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="nbr_sp"/>         
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="det_num_nom_adj" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genero"/></tag>
                  <tag><var n="numero"/></tag>
                  <tag><var n="genero_sl"/></tag>
                  <tag><var n="numero_sl"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/> 
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="gen_mf"/>         
                  <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/> 
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="gen_mf"/>         
                  <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="nbr_sp"/>         
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/> 
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="gen_mf"/>         
                  <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="nbr_sp"/>         
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/> 
                  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="gen_mf"/>         
                  <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="nbr_sp"/>         
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: NOM ADJ ADJ">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>        
        <out>
          <chunk name="nom_adj_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET NOM ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_nom_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET NOM ADJ ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_nom_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET TOP ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="top"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_top_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET TOP ADJ ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="top"/>
        <pattern-item n="adj"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_top_adj_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET ADV ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adv"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_adv_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET NOM habitual (el partit habitual > il solito partito)">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="habitual"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    

    <rule comment="REGLA: DET ADJ NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    

    <rule comment="REGLA: DET ADJ NOM ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_adj_nom_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    

    <rule comment="REGLA: DET ADJ cnj ADJ NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="cnjcoo"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="5"/>
          <with-param pos="2"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>        
        <out>
          <chunk name="det_adj_cnjcoo_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu> 
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/> 
              <clip pos="5" side="tl" part="a_nom"/>
              <clip pos="5" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="5" side="tl" part="gen_mf"/>         
              <clip pos="5" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="5" side="tl" part="nbr_sp"/>         
              <clip pos="5" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: NUM ADV ADJ NOM">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="4"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="num_adv_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: NUM ADJ NOM">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="num_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: NUM ADJ cnj ADJ NOM">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="cnjcoo"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="5"/>
          <with-param pos="2"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="num_adj_cnjcoo_adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu> 
            <b pos="3"/>
            
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu> 
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/> 
              <clip pos="5" side="tl" part="a_nom"/>
              <clip pos="5" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="5" side="tl" part="gen_mf"/>         
              <clip pos="5" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="5" side="tl" part="nbr_sp"/>         
              <clip pos="5" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    
    <rule comment="REGLA: NUM NOM ADJ">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>        
        <out>
          <chunk name="num_nom_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET NOM ADV ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adv_preadv"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="det_nom_adv_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM ADV ADJ">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adv_preadv"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>        
        <out>
          <chunk name="det_nom_adv_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NUM NOM ADV ADJ">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adv_preadv"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <out>
          <chunk name="num_nom_adv_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM ADJ cnjcoo ADJ">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="cnjcoo"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="4"/>
        </call-macro>        
        <out>
          <chunk name="nom_adj_cnjcoo_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/> 
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="gen_mf"/>         
              <clip pos="4" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="nbr_sp"/>         
              <clip pos="4" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: DET NOM ADJ cnjcoo ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="cnjcoo"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_chunk_tags">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
          <with-param pos="5"/>
        </call-macro>        
        <out>
          <chunk name="det_nom_adj_cnjcoo_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
              <tag><var n="genero_sl"/></tag>
              <tag><var n="numero_sl"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="gen_mf"/>         
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="nbr_sp"/>         
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="gen_mf"/>         
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="nbr_sp"/>         
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>         
              <clip pos="3" side="tl" part="lemq"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="whole"/> 
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/>
              <clip pos="5" side="tl" part="a_adj"/>
              <clip pos="5" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="5" side="tl" part="gen_mf"/>         
              <clip pos="5" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="5" side="tl" part="nbr_sp"/>         
              <clip pos="5" side="tl" part="lemq"/>
            </lu> 
          </chunk>
        </out>
      </action>
    </rule>

    <!--  FI REGLES DE COORDINACIÓ -->


    <rule comment="REGLA: gens de NOM > niente NOM">
      <pattern>
        <pattern-item n="gens"/>
        <pattern-item n="de"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <out>
          <chunk name="det_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <lit v="niente"/>
              <lit-tag v="adj.mf.sp"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="gen_mf"/>         
              <clip pos="3" side="tl" part="nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="nbr_sp"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- REGLES data -->

    <rule comment="regla: dia de mes: 1 de maig > 1 maggio">
      <pattern>
        <pattern-item n="dia"/>
        <pattern-item n="de"/>
        <pattern-item n="mes"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <out>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: dia de mes de any: 1 de maig de 2017 > 1 maggio 2017">
      <pattern>
        <pattern-item n="dia"/>
        <pattern-item n="de"/>
        <pattern-item n="mes"/>
        <pattern-item n="de"/>
        <pattern-item n="any"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <call-macro n="f_bcond"><with-param pos="3"/><with-param pos="4"/></call-macro>
        <out>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="lem"/>
              <clip pos="5" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: mes de any: maig de 2017 > maggio 2017">
      <pattern>
        <pattern-item n="mes"/>
        <pattern-item n="de"/>
        <pattern-item n="any"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <out>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: el dia de mes de any: l'1 de maig de 2017 > nell'1 maggio 2017">
      <pattern>
        <pattern-item n="el"/>
        <pattern-item n="dia"/>
        <pattern-item n="de"/>
        <pattern-item n="mes"/>
        <pattern-item n="de"/>
        <pattern-item n="any"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="2"/><with-param pos="3"/></call-macro>
        <call-macro n="f_bcond"><with-param pos="4"/><with-param pos="5"/></call-macro>
        <out>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="in"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="tags"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
            <b pos="5"/>
            <lu>
              <clip pos="6" side="tl" part="lem"/>
              <clip pos="6" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: el dia de mes: l'1 de maig> nell'1 maggio">
      <pattern>
        <pattern-item n="el"/>
        <pattern-item n="dia"/>
        <pattern-item n="de"/>
        <pattern-item n="mes"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="2"/><with-param pos="3"/></call-macro>
        <out>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="in"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="tags"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: el mes de any: el maig de 2017 > nell maggio 2017">
      <pattern>
        <pattern-item n="el"/>
        <pattern-item n="mes"/>
        <pattern-item n="de"/>
        <pattern-item n="any"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="2"/><with-param pos="3"/></call-macro>
        <out>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="in"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lem"/>
              <clip pos="4" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: prep el dia de mes de any: de l'1 de maig de 2017 > dell'1 maggio 2017">
      <pattern>
        <pattern-item n="pr"/>
        <pattern-item n="el"/>
        <pattern-item n="dia"/>
        <pattern-item n="de"/>
        <pattern-item n="mes"/>
        <pattern-item n="de"/>
        <pattern-item n="any"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="3"/><with-param pos="4"/></call-macro>
        <call-macro n="f_bcond"><with-param pos="5"/><with-param pos="6"/></call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/>
              <clip pos="5" side="tl" part="tags"/>
              <clip pos="5" side="tl" part="lemq"/>
            </lu>
            <b pos="6"/>
            <lu>
              <clip pos="7" side="tl" part="lem"/>
              <clip pos="7" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: prep el dia de mes: de l'1 de maig > dell'1 maggio">
      <pattern>
        <pattern-item n="pr"/>
        <pattern-item n="el"/>
        <pattern-item n="dia"/>
        <pattern-item n="de"/>
        <pattern-item n="mes"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="3"/><with-param pos="4"/></call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="tags"/>
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/>
              <clip pos="5" side="tl" part="tags"/>
              <clip pos="5" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="regla: prep mes de any: del maig de 2017 > del maggio 2017">
      <pattern>
        <pattern-item n="pr"/>
        <pattern-item n="el"/>
        <pattern-item n="mes"/>
        <pattern-item n="de"/>
        <pattern-item n="any"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="3"/><with-param pos="4"/></call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="data">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genero"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="tags"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="5" side="tl" part="lem"/>
              <clip pos="5" side="tl" part="tags"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- fi REGLES data -->

    <rule comment="regla: fa num periode: fa tres anys > tre anni fa, fa alguns anys > alcuni anni fa, fa pocs anys > pochi anni fa">
      <pattern>
        <pattern-item n="fa"/>
        <pattern-item n="num_det_adj"/>
        <pattern-item n="periode"/>
      </pattern>
      <action>
        <call-macro n="f_salvar_gen_num"></call-macro>
        <call-macro n="f_concord2"><with-param pos="3"/><with-param pos="2"/></call-macro>
        <call-macro n="firstWord"><with-param pos="1"/></call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes"><clip pos="2" side="sl" part="lem"/><lit v="un"/></equal>
                <equal><clip pos="2" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
              </and>
            </test>
            <let><clip pos="2" side="tl" part="lem"/><lit v="alcun"/></let>
            <let><clip pos="2" side="tl" part="a_det"/><lit-tag v="det.ind"/></let>
          </when>
        </choose>
        <out>
          <chunk name="num-n-fa">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <get-case-from pos="3">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_restaurar_gen_num"></call-macro>
      </action>
    </rule>

    <rule comment="regla: fa uns num periode: fa uns tres anys > circa tre anni fa">
      <pattern>
        <pattern-item n="fa"/>
        <pattern-item n="uns_propde"/>
        <pattern-item n="num"/>
        <pattern-item n="periode"/>
      </pattern>
      <action>
        <call-macro n="f_salvar_gen_num"></call-macro>
        <call-macro n="f_concord3"><with-param pos="4"/><with-param pos="3"/><with-param pos="2"/></call-macro>
        <call-macro n="firstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="adv-num-n-fa">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="circa"/>
              </get-case-from>
              <lit-tag v="adv"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="tags"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <get-case-from pos="4">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_restaurar_gen_num"></call-macro>
      </action>
    </rule>

    <rule comment="regla: fa nom de periode: fa milions d'anys > milioni di anni fa">
      <pattern>
        <pattern-item n="fa"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="periode"/>
      </pattern>
      <action>
        <call-macro n="f_salvar_gen_num"></call-macro>
        <call-macro n="f_concord1"><with-param pos="2"/></call-macro>
        <call-macro n="f_concord1"><with-param pos="4"/></call-macro>
        <call-macro n="firstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="n-di-n-fa">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="tags"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <get-case-from pos="4">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_restaurar_gen_num"></call-macro>
      </action>
    </rule>

    <rule comment="regla: fa num nom de periode: fa tres milions d'anys > tre milioni di anni fa, fa alguns milions d'anys > alcuni milioni di anni fa, fa pocs milions d'anys > pochi milioni di anni fa">
      <pattern>
        <pattern-item n="fa"/>
        <pattern-item n="num_det_adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="periode"/>
      </pattern>
      <action>
        <call-macro n="f_salvar_gen_num"></call-macro>
        <call-macro n="f_concord2"><with-param pos="3"/><with-param pos="2"/></call-macro>
        <call-macro n="firstWord"><with-param pos="1"/></call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes"><clip pos="2" side="sl" part="lem"/><lit v="un"/></equal>
                <equal><clip pos="2" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
              </and>
            </test>
            <let><clip pos="2" side="tl" part="lem"/><lit v="alcun"/></let>
            <let><clip pos="2" side="tl" part="a_det"/><lit-tag v="det.ind"/></let>
          </when>
        </choose>
        <out>
          <chunk name="num-n-di-n-fa">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="2" side="tl" part="tags"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="tags"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/>
              <clip pos="5" side="tl" part="tags"/>
              <clip pos="5" side="tl" part="lemq"/>
            </lu>
            <b pos="4"/>
            <lu>
              <get-case-from pos="5">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_restaurar_gen_num"></call-macro>
      </action>
    </rule>

    <rule comment="regla: fa uns num nom de periode: fa uns tres milions d'anys > circa tre milioni di anni fa">
      <pattern>
        <pattern-item n="fa"/>
        <pattern-item n="uns_propde"/>
        <pattern-item n="num_det_adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="periode"/>
      </pattern>
      <action>
        <call-macro n="f_salvar_gen_num"></call-macro>
        <call-macro n="f_concord3"><with-param pos="4"/><with-param pos="3"/><with-param pos="2"/></call-macro>
        <call-macro n="firstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="adv-num-n-di-n-fa">
            <tags>
              <tag><lit-tag v="SAdv"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="circa"/>
              </get-case-from>
              <lit-tag v="adv"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="tags"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="tags"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="5" side="tl" part="lemh"/>
              <clip pos="5" side="tl" part="tags"/>
              <clip pos="5" side="tl" part="lemq"/>
            </lu>
            <b pos="4"/>
            <lu>
              <clip pos="6" side="tl" part="lemh"/>
              <clip pos="6" side="tl" part="tags"/>
              <clip pos="6" side="tl" part="lemq"/>
            </lu>
            <b pos="5"/>
            <lu>
              <get-case-from pos="6">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="1" side="tl" part="tags"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="f_restaurar_gen_num"></call-macro>
      </action>
    </rule>

    <!-- fi REGLES fa -->

    <rule comment="REGLA: EL DE (el de > quello di)">
      <pattern>
        <pattern-item n="el"/>
        <pattern-item n="de"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="pronom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="prn.tn"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="sl" part="nbr"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="quello"/>
              </get-case-from>
              <lit-tag v="prn.tn"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="sl" part="nbr"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <call-macro n="firstWord">
          <with-param pos="2"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="2" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <!-- REGLES SV -->

    <rule comment="REGLA: vfin">
      <pattern>
        <pattern-item n="vfin"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1"> <!-- hi ha > c'è, ci sono -->
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><var n="numero"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="5"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: inf">
      <pattern>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: al + inf > a + inf">
      <pattern>
        <pattern-item n="a"/>
        <pattern-item n="el_m_sg"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <call-macro n="f_bcond"><with-param pos="2"/><with-param pos="3"/></call-macro>
        <let><var n="lemma"/><clip pos="3" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: al + inf + enc > a + inf + enc">
      <pattern>
        <pattern-item n="a"/>
        <pattern-item n="el_m_sg"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="4"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <call-macro n="f_bcond"><with-param pos="2"/><with-param pos="3"/></call-macro>
        <let><var n="lemma"/><clip pos="3" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="temps"/></tag>
            </tags>
            <mlu>
              <lu>
                <clip pos="3" side="tl" part="lem"/> 
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="pers"/>         
                <clip pos="3" side="tl" part="nbr"/>
              </lu> 
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="tipus_prn"/>
                <clip pos="4" side="tl" part="pers"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </chunk>
        </out>
      </action>
    </rule>

   <rule comment="al + vbhaver + pp > a + aux + pp">
     <pattern>
        <pattern-item n="a"/>
        <pattern-item n="el_m_sg"/>
        <pattern-item n="vbhaver"/>
        <pattern-item n="pp"/>
     </pattern>
     <action>
       <call-macro n="vauxiliar">
         <with-param pos="3"/>
         <with-param pos="4"/>
       </call-macro>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <call-macro n="f_bcond"><with-param pos="2"/><with-param pos="3"/></call-macro>
        <let><var n="lemma"/><clip pos="4" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="4" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="temps"/></tag>
              <tag><clip pos="3" side="tl" part="pers"/></tag>
              <tag><clip pos="4" side="tl" part="gen"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="pers"/>         
              <clip pos="3" side="tl" part="nbr"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_verb"/>
              <clip pos="4" side="tl" part="temps"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ger">
      <pattern>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: tot ger > ger: Treballava tot cantant, lavorava cantando">
      <pattern>
        <pattern-item n="tot_adv"/>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="2" side="tl" part="lem"/></let>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- REGLES CALDRE -->

    <rule comment="REGLA: prnpropers caldrefin: em cal > ho bisogno">
      <pattern>
        <pattern-item n="prnpropers"/>
        <pattern-item n="caldrefin"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><lit v="avere# bisogno"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><lit-tag v="vblex"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="avere"/>
              </get-case-from>
              <lit-tag v="vblex"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr_sense_sp" link-to="5"/>
            </lu>
            <b pos="1"/>
            <lu>
              <get-case-from pos="2">
                <lit v="bisogno"/>
              </get-case-from>
              <lit-tag v="n.m.sg"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: caldreinf_ger enc: caldre'm > essermi necessario">
      <pattern>
        <pattern-item n="caldreinf_ger"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <let><var n="lemma"/><lit v="essere# necessario"/></let>
        <choose>
          <when>
            <test>
              <not>
                <or>
                  <equal><var n="genero"/><lit-tag v="m"/></equal>
                  <equal><var n="genero"/><lit-tag v="f"/></equal>
                </or>
              </not>
            </test>
            <let><var n="genero"/><lit-tag v="m"/></let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <not>
                <or>
                  <equal><var n="numero"/><lit-tag v="sg"/></equal>
                  <equal><var n="numero"/><lit-tag v="pl"/></equal>
                </or>
              </not>
            </test>
            <let><var n="numero"/><lit-tag v="sg"/></let>
          </when>
        </choose>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><lit-tag v="vblex"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <mlu>
              <lu>
                <get-case-from pos="1">
                  <lit v="essere"/>
                </get-case-from>
                <lit-tag v="vbser"/>
                <clip pos="1" side="tl" part="temps"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
              </lu>
            </mlu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="necessario"/>
              </get-case-from>
              <lit-tag v="adj"/>
              <var n="genero"/>
              <var n="numero"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: caldreinf_ger enc enc: caldre-me'n > essermene necessario">
      <pattern>
        <pattern-item n="caldreinf_ger"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <let><var n="lemma"/><lit v="essere# necessario"/></let>
        <choose>
          <when>
            <test>
              <not>
                <or>
                  <equal><var n="genero"/><lit-tag v="m"/></equal>
                  <equal><var n="genero"/><lit-tag v="f"/></equal>
                </or>
              </not>
            </test>
            <let><var n="genero"/><lit-tag v="m"/></let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <not>
                <or>
                  <equal><var n="numero"/><lit-tag v="sg"/></equal>
                  <equal><var n="numero"/><lit-tag v="pl"/></equal>
                </or>
              </not>
            </test>
            <let><var n="numero"/><lit-tag v="sg"/></let>
          </when>
        </choose>
        <choose>
          <when>
            <!-- en + hi: cal canviar l'ordre -->
            <test>
              <and>
                <equal><clip pos="2" side="sl" part="lem"/><lit v="en"/></equal>
                <equal><clip pos="3" side="sl" part="lem"/><lit v="hi"/></equal>
              </and>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <get-case-from pos="1">
                      <lit v="essere"/>
                    </get-case-from>
                    <lit-tag v="vbser"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <lit v="necessario"/>
                  </get-case-from>
                  <lit-tag v="adj"/>
                  <var n="genero"/>
                  <var n="numero"/>
                </lu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- el + enc: cal eliminar el segon clític -->
            <test>
              <equal><clip pos="2" side="sl" part="lem"/><lit v="el"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <get-case-from pos="1">
                      <lit v="essere"/>
                    </get-case-from>
                    <lit-tag v="vbser"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <lit v="necessario"/>
                  </get-case-from>
                  <lit-tag v="adj"/>
                  <var n="genero"/>
                  <var n="numero"/>
                </lu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- enc + li: cal eliminar el primer clític (posant-me-li, etc.) -->
            <test>
              <equal><clip pos="3" side="sl" part="lem"/><lit v="li"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <get-case-from pos="1">
                      <lit v="essere"/>
                    </get-case-from>
                    <lit-tag v="vbser"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <lit v="necessario"/>
                  </get-case-from>
                  <lit-tag v="adj"/>
                  <var n="genero"/>
                  <var n="numero"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><lit-tag v="vblex"/></tag>
                  <tag><clip pos="1" side="tl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <get-case-from pos="1">
                      <lit v="essere"/>
                    </get-case-from>
                    <lit-tag v="vbser"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                  </lu>
                </mlu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <lit v="necessario"/>
                  </get-case-from>
                  <lit-tag v="adj"/>
                  <var n="genero"/>
                  <var n="numero"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: prnpropers HAVER caldrepp: m'han calgut > ho avuto bisogno">
      <pattern>
        <pattern-item n="prnpropers"/>
        <pattern-item n="haverp3"/>
        <pattern-item n="caldrepp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><lit v="avere# bisogno"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><lit-tag v="vblex"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="pers"/>         
              <clip pos="1" side="tl" part="nbr"/>
            </lu> 
            <b pos="1"/>
            <lu>
              <get-case-from pos="2">
                <lit v="avere"/>
              </get-case-from>
              <lit-tag v="vblex.pp.m.sg"/>
            </lu>
            <b pos="2"/>
            <lu>
              <get-case-from pos="3">
                <lit v="bisogno"/>
              </get-case-from>
              <lit-tag v="n.m.sg"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: prnpropers ANAR caldreinf: em van caler > ebbi bisogno">
      <pattern>
        <pattern-item n="prnpropers"/>
        <pattern-item n="anar_pri_p3"/>
        <pattern-item n="caldreinf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><lit v="avere# bisogno"/></let>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><lit-tag v="vblex"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="avere"/>
              </get-case-from>
              <lit-tag v="vblex.ifi"/>
              <clip pos="1" side="tl" part="pers"/>         
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <get-case-from pos="3">
                <lit v="bisogno"/>
              </get-case-from>
              <lit-tag v="n.m.sg"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: prnpropers necessitarp3: es necessita > c'è bisogno">
      <pattern>
        <pattern-item n="es"/>
        <pattern-item n="necessitarp3"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><lit v="ci essere bisogno"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><lit-tag v="vblex"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
            <lu>
              <get-case-from pos="1">
                <lit v="ci"/>
              </get-case-from>
              <lit-tag v="prn.pro.adv"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="essere"/>
              </get-case-from>
              <lit-tag v="vbser"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="pers"/>
              <clip pos="2" side="tl" part="nbr_sense_sp" link-to="5"/>
            </lu>
            <b pos="1"/>
            <lu>
              <get-case-from pos="2">
                <lit v="bisogno"/>
              </get-case-from>
              <lit-tag v="n.m.sg"/>
            </lu>
          </chunk>
          <b/>
          <chunk name="di">
            <tags>
              <tag><lit-tag v="pr"/></tag>
            </tags>
            <lu>
              <lit v="di"/>
              <lit-tag v="pr"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- FI REGLES CALDRE -->

    <rule comment="PRNREF HAVER PP > PRNREF SER PP: s'ha perdut > si è perso, m'ha dit > mi ha detto">
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="vbhaver"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="3" side="tl" part="lem"/></let>
        <choose>
          <when>
            <test>
              <or>
                <and>
                  <not><equal><clip pos="2" side="sl" part="pers"/><lit-tag v="p3"/></equal></not>
                  <equal><clip pos="1" side="sl" part="pers"/><clip pos="2" side="sl" part="pers"/></equal>
                  <or>
                    <equal><clip pos="1" side="sl" part="nbr"/><clip pos="2" side="sl" part="nbr"/></equal>
                    <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
                  </or>
                </and>
                <and>
                  <equal><clip pos="2" side="sl" part="pers"/><lit-tag v="p3"/></equal>
                  <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="es"/></equal>
                </and>
                <in caseless="yes"><clip pos="3" side="tl" part="lemh"/><list n="vbambser"/></in>
              </or>
            </test>
            <let><clip pos="2" side="tl" part="lem"/><lit v="essere"/></let>
            <let><clip pos="2" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="3" side="tl" part="nbr"/><clip pos="2" side="sl" part="nbr"/></let>
            <choose>
              <when>
                <test>
                    <or>
                      <equal><var n="genero"/><lit-tag v="m"/></equal>
                      <equal><var n="genero"/><lit-tag v="f"/></equal>
                    </or>
                </test>
                <let><clip pos="3" side="tl" part="gen"/><var n="genero"/></let>
              </when>
            </choose>
          </when>
        </choose>
        <out>
          <chunk name="pronom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="tipus_prn"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk namefrom="lemma">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="3" side="tl" part="gen"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="pers"/>         
              <clip pos="2" side="tl" part="nbr"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="PRNREF PRONPRO HAVER PP > PRNREF PRONPRO SER PP: s'hi ha perdut > si c'è perso, me n'ha donat > mi ne ha datto">
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="vbhaver"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="4" side="tl" part="lem"/></let>
        <choose>
          <when>
            <test>
              <or>
                <and>
                  <not><equal><clip pos="3" side="sl" part="pers"/><lit-tag v="p3"/></equal></not>
                  <equal><clip pos="1" side="sl" part="pers"/><clip pos="3" side="sl" part="pers"/></equal>
                  <or>
                    <equal><clip pos="1" side="sl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></equal>
                    <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
                  </or>
                </and>
                <and>
                  <equal><clip pos="3" side="sl" part="pers"/><lit-tag v="p3"/></equal>
                  <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="es"/></equal>
                </and>
                <in caseless="yes"><clip pos="4" side="tl" part="lemh"/><list n="vbambser"/></in>
              </or>
            </test>
            <let><clip pos="3" side="tl" part="lem"/><lit v="essere"/></let>
            <let><clip pos="3" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="4" side="tl" part="nbr"/><clip pos="3" side="sl" part="nbr"/></let>
            <choose>
              <when>
                <test>
                    <or>
                      <equal><var n="genero"/><lit-tag v="m"/></equal>
                      <equal><var n="genero"/><lit-tag v="f"/></equal>
                    </or>
                </test>
                <let><clip pos="4" side="tl" part="gen"/><var n="genero"/></let>
              </when>
            </choose>
          </when>
        </choose>
        <out>
          <chunk name="pronom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="tipus_prn"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="pronom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="2" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="gen"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="tipus_prn"/>
              <clip pos="2" side="tl" part="pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="2"/>
          <chunk namefrom="lemma">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="4" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="temps"/></tag>
              <tag><clip pos="3" side="tl" part="pers"/></tag>
              <tag><clip pos="4" side="tl" part="gen"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lem"/> 
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="pers"/>         
              <clip pos="3" side="tl" part="nbr"/>
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_verb"/>
              <clip pos="4" side="tl" part="temps"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="PRNREF HAVER ADV PP > PRNREF SER ADV PP: s'ha sempre perdut > si è sempre perso, m'ha sempre dit > mi ha sempre detto">
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="vbhaver"/>
        <pattern-item n="adv"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="4" side="tl" part="lem"/></let>
        <choose>
          <when>
            <test>
              <or>
                <and>
                  <not><equal><clip pos="2" side="sl" part="pers"/><lit-tag v="p3"/></equal></not>
                  <equal><clip pos="1" side="sl" part="pers"/><clip pos="2" side="sl" part="pers"/></equal>
                  <or>
                    <equal><clip pos="1" side="sl" part="nbr"/><clip pos="2" side="sl" part="nbr"/></equal>
                    <equal><clip pos="1" side="sl" part="nbr"/><lit-tag v="sp"/></equal>
                  </or>
                </and>
                <and>
                  <equal><clip pos="2" side="sl" part="pers"/><lit-tag v="p3"/></equal>
                  <equal caseless="yes"><clip pos="1" side="sl" part="lem"/><lit v="es"/></equal>
                </and>
                <in caseless="yes"><clip pos="4" side="tl" part="lemh"/><list n="vbambser"/></in>
              </or>
            </test>
            <let><clip pos="2" side="tl" part="lem"/><lit v="essere"/></let>
            <let><clip pos="2" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
            <let><clip pos="4" side="tl" part="nbr"/><clip pos="2" side="sl" part="nbr"/></let>
            <choose>
              <when>
                <test>
                    <or>
                      <equal><var n="genero"/><lit-tag v="m"/></equal>
                      <equal><var n="genero"/><lit-tag v="f"/></equal>
                    </or>
                </test>
                <let><clip pos="4" side="tl" part="gen"/><var n="genero"/></let>
              </when>
            </choose>
          </when>
        </choose>
        <out>
          <chunk name="pronom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="tipus_prn"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk namefrom="lemma">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="4" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="4" side="tl" part="gen"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="pers"/>         
              <clip pos="2" side="tl" part="nbr"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="whole"/> 
            </lu> 
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/> 
              <clip pos="4" side="tl" part="a_verb"/>
              <clip pos="4" side="tl" part="temps"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="nbr"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

   <rule comment="vbhaver + pp">
     <pattern>
        <pattern-item n="vbhaver"/>
        <pattern-item n="pp"/>
     </pattern>
     <action>
       <call-macro n="vauxiliar">
         <with-param pos="1"/>
         <with-param pos="2"/>
       </call-macro>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
        <let><var n="lemma"/><clip pos="2" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/> 
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="pers"/>         
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu> 
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/> 
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- pronoms enclítics -->

    <rule comment="ger prnenc">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <!--<call-macro n="tipus_verb">
          <with-param pos="1"/>
        </call-macro>-->
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="sl" part="temps"/></tag>
              <!--<tag><var n="tipusverb"/></tag>
              <tag><var n="cv_verb"/></tag>-->
            </tags>
            <mlu>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>
    
    <rule comment="ger prnenc prnenc">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <choose>
          <when>
            <!-- en + hi: cal canviar l'ordre -->
            <test>
              <and>
                <equal><clip pos="2" side="sl" part="lem"/><lit v="en"/></equal>
                <equal><clip pos="3" side="sl" part="lem"/><lit v="hi"/></equal>
              </and>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- el + enc: cal eliminar el segon clític -->
            <test>
              <equal><clip pos="2" side="sl" part="lem"/><lit v="el"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- enc + li: cal eliminar el primer clític (posant-me-li, etc.) -->
            <test>
              <equal><clip pos="3" side="sl" part="lem"/><lit v="li"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>


    <rule comment="REGLA: imp">
      <pattern>
        <pattern-item n="imp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <!--<tag><var n="tipusverb"/></tag>
              <tag><var n="cv_verb"/></tag>-->
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="imp prnenc">
      <pattern>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <!--<call-macro n="tipus_verb">
          <with-param pos="1"/>
        </call-macro>-->
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <choose>
          <when>
            <test>
              <equal><clip pos="1" side="sl" part="pers"/><lit-tag v="p3"/></equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal><clip pos="2" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.adv"/></equal>
                </test>
                <let><var n="aux1"/><lit-tag v="prn.pro.adv"/></let>
              </when>
              <when>
                <test>
                  <equal><clip pos="2" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.ref"/></equal>
                </test>
                <let><var n="aux1"/><lit-tag v="prn.pro.ref"/></let>
              </when>
              <when>
                <test>
                  <and>
                    <equal><clip pos="2" side="sl" part="lem"/><lit v="li"/></equal>
                    <equal><clip pos="2" side="sl" part="gen"/><lit-tag v="mf"/></equal>
                    <equal><clip pos="2" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
                  </and>
                </test>
                <let><var n="aux1"/><lit-tag v="prn.pro"/></let>
                <let><clip pos="2" side="tl" part="lem"/><lit v="gli"/></let>
                <let><clip pos="2" side="tl" part="gen"/><lit-tag v="m"/></let>
              </when>
              <otherwise>
                <let><var n="aux1"/><lit-tag v="prn.pro"/></let>
              </otherwise>
            </choose>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <!--<tag><var n="tipusverb"/></tag>
                  <tag><var n="cv_verb"/></tag>-->
                </tags>
                <lu>
                  <lit v="che"/>
                  <lit-tag v="cnjsub"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/>
                  <var n="aux1"/>
                  <clip pos="2" side="tl" part="pers"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <lit-tag v="prs"/>
                  <clip pos="1" side="tl" part="pers"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <!--<tag><var n="tipusverb"/></tag>
                  <tag><var n="cv_verb"/></tag>-->
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                    <clip pos="1" side="tl" part="pers"/>
                    <clip pos="1" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="imp prnenc prnenc">
      <pattern>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <!--<call-macro n="tipus_verb">
          <with-param pos="1"/>
        </call-macro>-->
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <choose>
          <when>
            <test>
              <equal><clip pos="1" side="sl" part="pers"/><lit-tag v="p3"/></equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal><clip pos="2" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.adv"/></equal>
                </test>
                <let><var n="aux1"/><lit-tag v="prn.pro.adv"/></let>
              </when>
              <when>
                <test>
                  <equal><clip pos="2" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.ref"/></equal>
                </test>
                <let><var n="aux1"/><lit-tag v="prn.pro.ref"/></let>
              </when>
              <when>
                <test>
                  <and>
                    <equal><clip pos="2" side="sl" part="lem"/><lit v="li"/></equal>
                    <equal><clip pos="2" side="sl" part="gen"/><lit-tag v="mf"/></equal>
                    <equal><clip pos="2" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
                  </and>
                </test>
                <let><var n="aux1"/><lit-tag v="prn.pro"/></let>
                <let><clip pos="2" side="tl" part="lem"/><lit v="gli"/></let>
                <let><clip pos="2" side="tl" part="gen"/><lit-tag v="m"/></let>
              </when>
              <otherwise>
                <let><var n="aux1"/><lit-tag v="prn.pro"/></let>
              </otherwise>
            </choose>
            <choose>
              <when>
                <test>
                  <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.adv"/></equal>
                </test>
                <let><var n="aux2"/><lit-tag v="prn.pro.adv"/></let>
              </when>
              <when>
                <test>
                  <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.ref"/></equal>
                </test>
                <let><var n="aux2"/><lit-tag v="prn.pro.ref"/></let>
              </when>
              <when>
                <test>
                  <and>
                    <equal><clip pos="3" side="sl" part="lem"/><lit v="li"/></equal>
                    <equal><clip pos="3" side="sl" part="gen"/><lit-tag v="mf"/></equal>
                    <equal><clip pos="3" side="sl" part="nbr"/><lit-tag v="pl"/></equal>
                  </and>
                </test>
                <let><var n="aux2"/><lit-tag v="prn.pro"/></let>
                <let><clip pos="3" side="tl" part="lem"/><lit v="gli"/></let>
                <let><clip pos="3" side="tl" part="gen"/><lit-tag v="m"/></let>
              </when>
              <otherwise>
                <let><var n="aux2"/><lit-tag v="prn.pro"/></let>
              </otherwise>
            </choose>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <!--<tag><var n="tipusverb"/></tag>
                  <tag><var n="cv_verb"/></tag>-->
                </tags>
                <lu>
                  <lit v="che"/>
                  <lit-tag v="cnjsub"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lem"/>
                  <var n="aux1"/>
                  <clip pos="2" side="tl" part="pers"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <var n="aux2"/>
                  <clip pos="3" side="tl" part="pers"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_verb"/>
                  <lit-tag v="prs"/>
                  <clip pos="1" side="tl" part="pers"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- en + hi: cal canviar l'ordre -->
            <test>
              <and>
                <equal><clip pos="2" side="sl" part="lem"/><lit v="en"/></equal>
                <equal><clip pos="3" side="sl" part="lem"/><lit v="hi"/></equal>
              </and>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <!--<tag><var n="tipusverb"/></tag>
                  <tag><var n="cv_verb"/></tag>-->
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                    <clip pos="1" side="tl" part="pers"/>
                    <clip pos="1" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- el + enc: cal eliminar el segon clític -->
            <test>
              <equal><clip pos="2" side="sl" part="lem"/><lit v="el"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <!--<tag><var n="tipusverb"/></tag>
                  <tag><var n="cv_verb"/></tag>-->
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                    <clip pos="1" side="tl" part="pers"/>
                    <clip pos="1" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- enc + li: cal eliminar el primer clític (posant-me-li, etc.) -->
            <test>
              <equal><clip pos="3" side="sl" part="lem"/><lit v="li"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <!--<tag><var n="tipusverb"/></tag>
                  <tag><var n="cv_verb"/></tag>-->
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                    <clip pos="1" side="tl" part="pers"/>
                    <clip pos="1" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <!--<tag><var n="tipusverb"/></tag>
                  <tag><var n="cv_verb"/></tag>-->
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                    <clip pos="1" side="tl" part="pers"/>
                    <clip pos="1" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="inf prnenc">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <!--<call-macro n="tipus_verb">
          <with-param pos="1"/>
        </call-macro>-->
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="sl" part="temps"/></tag>
              <!--<tag><var n="tipusverb"/></tag>
              <tag><var n="cv_verb"/></tag>-->
            </tags>
            <mlu>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="whole"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="inf prnenc prnenc">
      <pattern>
        <pattern-item n="inf"/>
          <pattern-item n="prnenc"/>
          <pattern-item n="prnenc"/>
        </pattern>
        <action>
          <call-macro n="f_concord1">
            <with-param pos="2"/>
          </call-macro>
          <!--<call-macro n="tipus_verb">
            <with-param pos="1"/>
          </call-macro>-->
          <call-macro n="firstWord">
            <with-param pos="1"/>
          </call-macro>
          <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
          <choose>
            <!-- en + hi: cal canviar l'ordre -->
            <when>
              <test>
                <and>
                  <equal><clip pos="2" side="sl" part="lem"/><lit v="en"/></equal>
                  <equal><clip pos="3" side="sl" part="lem"/><lit v="hi"/></equal>
                </and>
              </test>
              <out>
                <chunk namefrom="lemma" case="caseFirstWord">
                  <tags>
                    <tag><lit-tag v="SV"/></tag>
                    <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                    <tag><clip pos="1" side="sl" part="temps"/></tag>
                    <!--<tag><var n="tipusverb"/></tag>
                    <tag><var n="cv_verb"/></tag>-->
                  </tags>
                  <mlu>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_verb"/>
                      <clip pos="1" side="tl" part="temps"/>
                    </lu>
                    <lu>
                      <clip pos="3" side="tl" part="whole"/>
                    </lu>
                    <lu>
                      <clip pos="2" side="tl" part="whole"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                  </mlu>
                </chunk>
              </out>
            </when>
          <when>
            <!-- el + enc: cal eliminar el segon clític -->
            <test>
              <equal><clip pos="2" side="sl" part="lem"/><lit v="el"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
          <when>
            <!-- enc + li: cal eliminar el primer clític (posant-me-li, etc.) -->
            <test>
              <equal><clip pos="3" side="sl" part="lem"/><lit v="li"/></equal>
            </test>
            <out>
              <chunk namefrom="lemma" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><clip pos="1" side="sl" part="temps"/></tag>
                </tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="temps"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="whole"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk>
            </out>
          </when>
            <otherwise>
              <out>
                <chunk namefrom="lemma" case="caseFirstWord">
                  <tags>
                    <tag><lit-tag v="SV"/></tag>
                    <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                    <tag><clip pos="1" side="sl" part="temps"/></tag>
                    <!--<tag><var n="tipusverb"/></tag>
                    <tag><var n="cv_verb"/></tag>-->
                  </tags>
                  <mlu>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_verb"/>
                      <clip pos="1" side="tl" part="temps"/>
                    </lu>
                    <lu>
                      <clip pos="2" side="tl" part="whole"/>
                    </lu>
                    <lu>
                      <clip pos="3" side="tl" part="whole"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                  </mlu>
                </chunk>
              </out>
            </otherwise>
          </choose>
          <let>
            <var n="caseFirstWord"/>
            <lit v="aa"/>
          </let>
        </action>
      </rule>

   <rule comment="haver_inf + enc + pp">
     <pattern>
        <pattern-item n="haver_inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="pp"/>
     </pattern>
     <action>
       <call-macro n="vauxiliar">
         <with-param pos="1"/>
         <with-param pos="3"/>
       </call-macro>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
        <let><var n="lemma"/><clip pos="3" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="3" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <mlu>
              <lu>
                <clip pos="1" side="tl" part="lem"/> 
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="pers"/>         
                <clip pos="1" side="tl" part="nbr"/>
              </lu> 
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="tipus_prn"/>
                <clip pos="2" side="tl" part="pers"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </mlu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: tot ger prnenc: tot fent-ho, facendolo">
      <pattern>
        <pattern-item n="tot_adv"/>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <!--<call-macro n="tipus_verb">
          <with-param pos="1"/>
        </call-macro>-->
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <let><var n="lemma"/><clip pos="2" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <!--<tag><var n="tipusverb"/></tag>
              <tag><var n="cv_verb"/></tag>-->
            </tags>
            <mlu>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
              </lu>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>
    
    <rule comment="REGLA: tot ger prenc prnenc: tot fent-li-ho, facendoglielo">
      <pattern>
        <pattern-item n="tot_adv"/>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <let><var n="lemma"/><clip pos="2" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
            </tags>
            <mlu>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
              </lu>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

  <!-- REGLES hi ha -->

  <rule comment="regla: hi ha > c'è, ci sono (tots els temps simples)">
    <pattern>
      <pattern-item n="hi"/>
      <pattern-item n="haverp3"/>
    </pattern>
    <action>
      <call-macro n="f_concord1">
        <with-param pos="2"/>
      </call-macro>
      <call-macro n="firstWord">
        <with-param pos="1"/>
      </call-macro>
      <let><clip pos="2" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
      <out>
        <chunk name="hi_ha" case="caseFirstWord">
          <tags>
            <tag><lit-tag v="SV"/></tag>
            <tag><clip pos="2" side="tl" part="a_verb"/></tag>
            <tag><clip pos="2" side="tl" part="temps"/></tag>
            <tag><var n="numero"/></tag>
          </tags>
          <lu>
            <get-case-from pos="1">
              <lit v="ci"/>
            </get-case-from>
            <clip pos="1" side="tl" part="tags"/>
          </lu>
          <b pos="1"/>
          <lu>
            <get-case-from pos="2">
              <lit v="essere"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="temps"/>
            <clip pos="2" side="tl" part="pers"/>
            <clip pos="2" side="tl" part="nbr_sense_sp" link-to="4"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
        </chunk>
      </out>
    </action>
  </rule>

  <rule comment="regla: n'hi ha > ce ne è, ce ne sono (tots els temps simples)">
    <pattern>
      <pattern-item n="en_prn"/>
      <pattern-item n="hi"/>
      <pattern-item n="haverp3"/>
    </pattern>
    <action>
      <call-macro n="f_concord1">
        <with-param pos="3"/>
      </call-macro>
      <call-macro n="firstWord">
        <with-param pos="1"/>
      </call-macro>
      <let><clip pos="3" side="tl" part="a_verb"/><lit-tag v="vbser"/></let>
      <out>
        <chunk name="n_hi_ha" case="caseFirstWord">
          <tags>
            <tag><lit-tag v="SV"/></tag>
            <tag><clip pos="3" side="tl" part="a_verb"/></tag>
            <tag><clip pos="3" side="tl" part="temps"/></tag>
            <tag><var n="numero"/></tag>
          </tags>
          <lu>
            <get-case-from pos="1">
              <lit v="ce"/>
            </get-case-from>
            <clip pos="2" side="tl" part="tags"/>
          </lu>
          <b pos="1"/>
          <lu>
            <get-case-from pos="2">
              <lit v="ne"/>
            </get-case-from>
            <clip pos="1" side="tl" part="tags"/>
          </lu>
          <b pos="2"/>
          <lu>
            <get-case-from pos="3">
              <lit v="essere"/>
            </get-case-from>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="temps"/>
            <clip pos="3" side="tl" part="pers"/>
            <clip pos="3" side="tl" part="nbr_sense_sp" link-to="4"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </chunk>
      </out>
    </action>
  </rule>

   <rule comment="hi + vbhaver + pp">
     <pattern>
        <pattern-item n="hi"/>
        <pattern-item n="vbhaver"/>
        <pattern-item n="pp_sg"/>
     </pattern>
     <action>
       <call-macro n="vauxiliar">
         <with-param pos="2"/>
         <with-param pos="3"/>
       </call-macro>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
       <choose>
         <when>
           <test>
             <equal><clip pos="3" side="sl" part="a_verb"/><lit-tag v="vbhaver"/></equal>
           </test>
           <out>
             <chunk name="hi_ha" case="caseFirstWord">
               <tags>
                 <tag><lit-tag v="SV"/></tag>
                 <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                 <tag><clip pos="2" side="tl" part="temps"/></tag>
                 <tag><clip pos="3" side="tl" part="gen"/></tag>
                 <tag><var n="numero"/></tag>
               </tags>
               <lu>
                 <get-case-from pos="1">
                   <lit v="ci"/>
                 </get-case-from>
                 <clip pos="1" side="tl" part="tags"/>
               </lu>
               <b pos="1"/>
               <lu>
                 <get-case-from pos="2">
                   <lit v="essere"/>
                 </get-case-from>
                 <lit-tag v="vbser"/>
                 <clip pos="2" side="tl" part="temps"/>
                 <clip pos="2" side="tl" part="pers"/>
                 <clip pos="2" side="tl" part="nbr_sense_sp" link-to="5"/>
                 <clip pos="2" side="tl" part="lemq"/>
               </lu>
               <b pos="2"/>
               <lu>
                 <get-case-from pos="2">
                   <lit v="essere"/>
                 </get-case-from>
                 <lit-tag v="vbser"/>
                 <clip pos="3" side="tl" part="temps"/>
                 <clip pos="3" side="tl" part="gen_sense_mf" link-to="4"/>
                 <clip pos="3" side="tl" part="nbr_sense_sp" link-to="5"/>
               </lu>
             </chunk>
           </out>
         </when>
         <otherwise>
           <let><var n="lemma"/><clip pos="3" side="tl" part="lem"/></let>
           <out>
             <chunk name="Pronom4" case="caseFirstWord">
               <tags>
                 <tag><lit-tag v="SN"/></tag>
                 <tag><clip pos="1" side="tl" part="tipus_prn"/></tag>
                 <tag><clip pos="1" side="tl" part="pers"/></tag>
                 <tag><clip pos="1" side="tl" part="gen"/></tag>
                 <tag><clip pos="1" side="tl" part="nbr"/></tag>
               </tags>
               <lu>
                 <clip pos="1" side="tl" part="lem"/>
                 <clip pos="1" side="tl" part="tags"/>
               </lu>
             </chunk>
             <b pos="1"/>
             <chunk namefrom="lemma">
               <tags>
                 <tag><lit-tag v="SV"/></tag>
                 <tag><clip pos="3" side="tl" part="a_verb"/></tag>
                 <tag><clip pos="2" side="tl" part="temps"/></tag>
                 <tag><clip pos="2" side="tl" part="pers"/></tag>
                 <tag><clip pos="3" side="tl" part="gen"/></tag>
                 <tag><clip pos="2" side="tl" part="nbr"/></tag>
               </tags>
               <lu>
                 <clip pos="2" side="tl" part="lem"/> 
                 <clip pos="2" side="tl" part="a_verb"/>
                 <clip pos="2" side="tl" part="temps"/>
                 <clip pos="2" side="tl" part="pers"/>         
                 <clip pos="2" side="tl" part="nbr"/>
               </lu> 
               <b pos="2"/>
               <lu>
                 <clip pos="3" side="tl" part="lemh"/> 
                 <clip pos="3" side="tl" part="a_verb"/>
                 <clip pos="3" side="tl" part="temps"/>
                 <clip pos="3" side="tl" part="gen"/>
                 <clip pos="3" side="tl" part="nbr"/>
                 <clip pos="3" side="tl" part="lemq"/>
               </lu>
             </chunk>
           </out>
         </otherwise>
       </choose>
      </action>
    </rule>

  <!-- fi REGLES hi ha -->

  <!-- REGLES passat perifràstic -->
<!--
  <rule comment="regla: anar_pri inf: vaig anar > sono andato">
     <pattern>
       <pattern-item n="anar_pri"/>
       <pattern-item n="inf"/>
     </pattern>
     <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
       <call-macro n="f_vaux_anar_inf">
         <with-param pos="1"/>
         <with-param pos="2"/>
       </call-macro>
       <out>
         <chunk name="aux_pp" case="caseFirstWord">
           <tags>
             <tag><lit-tag v="SV"/></tag>
             <tag><clip pos="2" side="tl" part="a_verb"/></tag>
             <tag><clip pos="2" side="tl" part="temps"/></tag>
             <tag><clip pos="2" side="tl" part="gen"/></tag>
             <tag><clip pos="1" side="tl" part="nbr"/></tag>
           </tags>
             <lu>
               <clip pos="1" side="tl" part="lem"/>
               <clip pos="1" side="tl" part="a_verb"/>
               <clip pos="1" side="tl" part="temps"/>
               <clip pos="1" side="tl" part="pers"/>
               <clip pos="1" side="tl" part="nbr"/>
             </lu>
             <b pos="1"/>
             <lu>
               <clip pos="2" side="tl" part="lemh"/>
               <clip pos="2" side="tl" part="a_verb"/>
               <clip pos="2" side="tl" part="temps"/>
               <clip pos="2" side="tl" part="gen_sense_mf" link-to="4"/>
               <clip pos="2" side="tl" part="nbr"/>
               <clip pos="2" side="tl" part="lemq"/>
             </lu>
         </chunk>
       </out>
     </action>
  </rule>
-->

  <rule comment="regla: anar_pri inf: vaig anar > andai">
     <pattern>
       <pattern-item n="anar_pri"/>
       <pattern-item n="inf"/>
     </pattern>
     <action>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
       <call-macro n="f_vaux_anar_inf">
         <with-param pos="1"/>
         <with-param pos="2"/>
       </call-macro>
       <!--
       <call-macro n="f_set_sg1">
         <with-param pos="1"/>
       </call-macro>
       -->
       <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
       <out>
         <chunk name="ifi" case="caseFirstWord">
           <tags>
             <tag><lit-tag v="SV"/></tag>
             <tag><clip pos="2" side="tl" part="a_verb"/></tag>
             <tag><lit-tag v="ifi"/></tag>
             <tag><clip pos="1" side="tl" part="pers"/></tag>
             <tag><clip pos="1" side="tl" part="nbr"/></tag>
           </tags>
             <lu>
               <get-case-from pos="1">
                 <clip pos="2" side="tl" part="lemh"/>
               </get-case-from>
               <clip pos="2" side="tl" part="a_verb"/>
               <lit-tag v="ifi"/>
               <clip pos="1" side="tl" part="pers"/>
               <clip pos="1" side="tl" part="nbr"/>
               <clip pos="2" side="tl" part="lemq"/>
             </lu>
         </chunk>
       </out>
     </action>
  </rule>

  <rule comment="regla: hi va haver: hi va haver > ci fu">
     <pattern>
       <pattern-item n="hi"/>
       <pattern-item n="anar_pri_p3"/>
       <pattern-item n="haver_inf"/>

     </pattern>
     <action>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
       <out>
         <chunk name="hi_ha" case="caseFirstWord">
           <tags>
             <tag><lit-tag v="SV"/></tag>
             <tag><lit-tag v="vbser"/></tag>
             <tag><lit-tag v="ifi"/></tag>
             <tag><clip pos="2" side="tl" part="nbr"/></tag>
           </tags>
           <lu>
             <get-case-from pos="1">
               <lit v="ci"/>
             </get-case-from>
             <lit-tag v="prn.pro.adv"/>
           </lu>
           <b pos="1"/>
           <lu>
             <get-case-from pos="2">
               <lit v="essere"/>
             </get-case-from>
             <lit-tag v="vbser"/>
             <lit-tag v="ifi"/>
             <clip pos="2" side="tl" part="pers"/>
             <clip pos="2" side="tl" part="nbr_sense_sp" link-to="4"/>
           </lu>
         </chunk>
       </out>
       <call-macro n="f_bcond"><with-param pos="2"/><with-param pos="3"/></call-macro>
     </action>
  </rule>

  <rule comment="regla: anar_pri inf prnenc: vaig anar-hi > ci andai, va haver-hi > ci fu">
     <pattern>
       <pattern-item n="anar_pri"/>
       <pattern-item n="inf"/>
       <pattern-item n="prnenc"/>
     </pattern>
     <action>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
       <call-macro n="f_vaux_anar_inf">
         <with-param pos="1"/>
         <with-param pos="2"/>
       </call-macro>
       <!--
       <call-macro n="f_set_sg1">
         <with-param pos="1"/>
       </call-macro>
       -->
       <choose>
         <when>
           <test>
             <and>
               <equal><clip pos="2" side="sl" part="a_verb"/><lit-tag v="vbhaver"/></equal>
               <equal caseless="yes"><clip pos="1" side="sl" part="pers"/><lit v="p3"/></equal>
               <equal caseless="yes"><clip pos="3" side="sl" part="lem"/><lit v="hi"/></equal>
             </and>
           </test>
           <out>
             <chunk name="hi_ha" case="caseFirstWord">
               <tags>
                 <tag><lit-tag v="SV"/></tag>
                 <tag><lit-tag v="vbser"/></tag>
                 <tag><lit-tag v="ifi"/></tag>
                 <tag><clip pos="1" side="tl" part="nbr"/></tag>
               </tags>
               <lu>
                 <get-case-from pos="1">
                   <lit v="ci"/>
                 </get-case-from>
                 <lit-tag v="prn.pro.adv"/>
               </lu>
               <b pos="1"/>
               <lu>
                 <get-case-from pos="2">
                   <lit v="essere"/>
                 </get-case-from>
                 <lit-tag v="vbser"/>
                 <lit-tag v="ifi"/>
                 <clip pos="1" side="tl" part="pers"/>
                 <clip pos="1" side="tl" part="nbr_sense_sp" link-to="4"/>
               </lu>
             </chunk>
           </out>
         </when>
         <otherwise>
       <choose>
         <when>
           <test>
             <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.adv"/></equal>
           </test>
           <let><var n="aux1"/><lit-tag v="prn.pro.adv"/></let>
         </when>
         <when>
           <test>
             <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.ref"/></equal>
           </test>
           <let><var n="aux1"/><lit-tag v="prn.pro.ref"/></let>
           <choose>
             <when>
               <test>
                 <in caseless="yes"><clip pos="2" side="sl" part="lem"/><list n="verbs_reflexius"/></in>
               </test>
               <let><clip pos="3" side="tl" part="lem"/><lit v="se"/></let>
             </when>
             <otherwise>
               <let><clip pos="3" side="tl" part="lem"/><lit v="si"/></let>
             </otherwise>
           </choose>
         </when>
         <otherwise>
           <let><var n="aux1"/><lit-tag v="prn.pro"/></let>
         </otherwise>
       </choose>
       <out>
         <chunk name="prn_ifi" case="caseFirstWord">
           <tags>
             <tag><lit-tag v="SV"/></tag>
             <tag><clip pos="2" side="tl" part="a_verb"/></tag>
             <tag><lit-tag v="ifi"/></tag>
             <tag><clip pos="1" side="tl" part="pers"/></tag>
             <tag><clip pos="1" side="tl" part="nbr"/></tag>
           </tags>
             <lu>
               <get-case-from pos="1">
                 <clip pos="3" side="tl" part="lem"/>
               </get-case-from>
               <var n="aux1"/>
               <clip pos="3" side="tl" part="pers"/>
               <clip pos="3" side="tl" part="gen"/>
               <clip pos="3" side="tl" part="nbr"/>
             </lu>
             <b pos="1"/>
             <lu>
               <clip pos="2" side="tl" part="lemh"/>
               <clip pos="2" side="tl" part="a_verb"/>
               <lit-tag v="ifi"/>
               <clip pos="1" side="tl" part="pers"/>
               <clip pos="1" side="tl" part="nbr"/>
               <clip pos="2" side="tl" part="lemq"/>
             </lu>
         </chunk>
       </out>
         </otherwise>
       </choose>
     </action>
  </rule>

  <rule comment="regla: anar_pri inf prnenc prnenc: vaig donar-n'hi > ce ne diedi">
     <pattern>
       <pattern-item n="anar_pri"/>
       <pattern-item n="inf"/>
       <pattern-item n="prnenc"/>
       <pattern-item n="prnenc"/>
     </pattern>
     <action>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
       <call-macro n="f_vaux_anar_inf">
         <with-param pos="1"/>
         <with-param pos="2"/>
       </call-macro>
       <!--
       <call-macro n="f_set_sg1">
         <with-param pos="1"/>
       </call-macro>
       -->
       <choose>
         <when>
           <test>
             <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.adv"/></equal>
           </test>
           <let><var n="aux1"/><lit-tag v="prn.pro.adv"/></let>
         </when>
         <when>
           <test>
             <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.ref"/></equal>
           </test>
           <let><var n="aux1"/><lit-tag v="prn.pro.ref"/></let>
           <choose>
             <when>
               <test>
                 <in caseless="yes"><clip pos="2" side="sl" part="lem"/><list n="verbs_reflexius"/></in>
               </test>
               <let><clip pos="3" side="tl" part="lem"/><lit v="se"/></let>
             </when>
             <otherwise>
               <let><clip pos="3" side="tl" part="lem"/><lit v="si"/></let>
             </otherwise>
           </choose>
         </when>
         <otherwise>
           <let><var n="aux1"/><lit-tag v="prn.pro"/></let>
         </otherwise>
       </choose>
       <choose>
         <when>
           <test>
             <equal><clip pos="4" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.adv"/></equal>
           </test>
           <let><var n="aux2"/><lit-tag v="prn.pro.adv"/></let>
         </when>
         <when>
           <test>
             <equal><clip pos="4" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.ref"/></equal>
           </test>
           <let><var n="aux2"/><lit-tag v="prn.pro.ref"/></let>
           <let><clip pos="4" side="tl" part="lem"/><lit v="se"/></let>
         </when>
         <otherwise>
           <let><var n="aux2"/><lit-tag v="prn.pro"/></let>
         </otherwise>
       </choose>
       <choose>
         <!-- en + hi: cal canviar l'ordre -->
         <when>
           <test>
             <or>
               <equal caseless="yes"><clip pos="3" side="sl" part="lem"/><lit v="es"/></equal>
               <equal caseless="yes"><clip pos="4" side="sl" part="lem"/><lit v="hi"/></equal>
             </or>
           </test>
           <choose>
             <when>
               <test>
                <equal caseless="yes"><clip pos="4" side="sl" part="lem"/><lit v="hi"/></equal>
               </test>
               <let><clip pos="4" side="tl" part="lem"/><lit v="ce"/></let>
             </when>
           </choose>
           <out>
             <chunk name="prn_prn_ifi" case="caseFirstWord">
               <tags>
                 <tag><lit-tag v="SV"/></tag>
                 <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                 <tag><lit-tag v="ifi"/></tag>
                 <tag><clip pos="1" side="tl" part="pers"/></tag>
                 <tag><clip pos="1" side="tl" part="nbr"/></tag>
               </tags>
                 <lu>
                   <get-case-from pos="1">
                     <clip pos="4" side="tl" part="lem"/>
                   </get-case-from>
                   <var n="aux2"/>
                   <clip pos="4" side="tl" part="pers"/>
                   <clip pos="4" side="tl" part="gen"/>
                   <clip pos="4" side="tl" part="nbr"/>
                 </lu>
                 <b/>
                 <lu>
                   <clip pos="3" side="tl" part="lem"/>
                   <var n="aux1"/>
                   <clip pos="3" side="tl" part="pers"/>
                   <clip pos="3" side="tl" part="gen"/>
                   <clip pos="3" side="tl" part="nbr"/>
                 </lu>
                 <b pos="1"/>
                 <lu>
                   <clip pos="2" side="tl" part="lemh"/>
                   <clip pos="2" side="tl" part="a_verb"/>
                   <lit-tag v="ifi"/>
                   <clip pos="1" side="tl" part="pers"/>
                   <clip pos="1" side="tl" part="nbr"/>
                   <clip pos="2" side="tl" part="lemq"/>
                 </lu>
             </chunk>
           </out>
         </when>
         <otherwise>
           <out>
             <chunk name="prn_ifi" case="caseFirstWord">
               <tags>
                 <tag><lit-tag v="SV"/></tag>
                 <tag><clip pos="2" side="tl" part="a_verb"/></tag>
                 <tag><lit-tag v="ifi"/></tag>
                 <tag><clip pos="1" side="tl" part="pers"/></tag>
                 <tag><clip pos="1" side="tl" part="nbr"/></tag>
               </tags>
                 <lu>
                   <get-case-from pos="1">
                     <clip pos="3" side="tl" part="lem"/>
                   </get-case-from>
                   <var n="aux1"/>
                   <clip pos="3" side="tl" part="pers"/>
                   <clip pos="3" side="tl" part="gen"/>
                   <clip pos="3" side="tl" part="nbr"/>
                 </lu>
                 <b/>
                 <lu>
                   <clip pos="4" side="tl" part="lem"/>
                   <var n="aux2"/>
                   <clip pos="4" side="tl" part="pers"/>
                   <clip pos="4" side="tl" part="gen"/>
                   <clip pos="4" side="tl" part="nbr"/>
                 </lu>
                 <b pos="1"/>
                 <lu>
                   <clip pos="2" side="tl" part="lemh"/>
                   <clip pos="2" side="tl" part="a_verb"/>
                   <lit-tag v="ifi"/>
                   <clip pos="1" side="tl" part="pers"/>
                   <clip pos="1" side="tl" part="nbr"/>
                   <clip pos="2" side="tl" part="lemq"/>
                 </lu>
             </chunk>
           </out>
          </otherwise>
        </choose>
     </action>
  </rule>

  <rule comment="regla: anar_pri haver_inf pp: va haver dit > ebbe detto, va haver anat > fu andato">
     <pattern>
       <pattern-item n="anar_pri"/>
       <pattern-item n="haver_inf"/>
       <pattern-item n="pp"/>
     </pattern>
     <action>
       <call-macro n="vauxiliar3">
         <with-param pos="1"/>
         <with-param pos="2"/>
         <with-param pos="3"/>
       </call-macro>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
        <let><var n="lemma"/><clip pos="3" side="tl" part="lem"/></let>
        <call-macro n="f_bcond"><with-param pos="1"/><with-param pos="2"/></call-macro>
        <out>
          <chunk namefrom="lemma" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><lit-tag v="ifi"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="3" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lem"/> 
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="ifi"/>
              <clip pos="1" side="tl" part="pers"/>         
              <clip pos="1" side="tl" part="nbr"/>
            </lu> 
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/> 
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

  <rule comment="regla: anar_pri haver prnenc pp: va haver-li dit > gli ebbe detto, vaig haver-hi anat > ci fu andata, va haver-hi > ci fu stato">
     <pattern>
       <pattern-item n="anar_pri"/>
       <pattern-item n="haver_inf"/>
       <pattern-item n="prnenc"/>
       <pattern-item n="pp"/>
     </pattern>
     <action>
       <call-macro n="firstWord">
         <with-param pos="1"/>
       </call-macro>
       <call-macro n="vauxiliar3">
         <with-param pos="1"/>
         <with-param pos="2"/>
         <with-param pos="4"/>
       </call-macro>
       <!--
       <call-macro n="f_set_sg1">
         <with-param pos="1"/>
       </call-macro>
       -->
       <choose>
         <when>
           <test>
             <and>
               <equal><clip pos="4" side="sl" part="a_verb"/><lit-tag v="vbhaver"/></equal>
               <equal caseless="yes"><clip pos="1" side="sl" part="pers"/><lit v="p3"/></equal>
               <equal caseless="yes"><clip pos="3" side="sl" part="lem"/><lit v="hi"/></equal>
             </and>
           </test>
           <out>
             <chunk name="hi_ha" case="caseFirstWord">
               <tags>
                 <tag><lit-tag v="SV"/></tag>
                 <tag><lit-tag v="vbser"/></tag>
                 <tag><lit-tag v="ifi"/></tag>
                 <tag><clip pos="1" side="tl" part="nbr"/></tag>
               </tags>
               <lu>
                 <get-case-from pos="1">
                   <lit v="ci"/>
                 </get-case-from>
                 <lit-tag v="prn.pro.adv"/>
               </lu>
               <b pos="1"/>
               <lu>
                 <get-case-from pos="2">
                   <lit v="essere"/>
                 </get-case-from>
                 <lit-tag v="vbser"/>
                 <lit-tag v="ifi"/>
                 <clip pos="1" side="tl" part="pers"/>
                 <clip pos="1" side="tl" part="nbr_sense_sp" link-to="4"/>
               </lu>
               <b pos="3"/>
               <lu>
                 <get-case-from pos="4">
                   <lit v="essere"/>
                 </get-case-from>
                 <lit-tag v="vbser"/>
                 <clip pos="4" side="tl" part="temps"/>
                 <clip pos="4" side="tl" part="gen"/>
                 <clip pos="4" side="tl" part="nbr_sense_sp" link-to="4"/>
               </lu>
             </chunk>
           </out>
         </when>
         <otherwise>
       <choose>
         <when>
           <test>
             <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.adv"/></equal>
           </test>
           <let><var n="aux1"/><lit-tag v="prn.pro.adv"/></let>
         </when>
         <when>
           <test>
             <equal><clip pos="3" side="sl" part="tipus_prn"/><lit-tag v="prn.enc.ref"/></equal>
           </test>
           <let><var n="aux1"/><lit-tag v="prn.pro.ref"/></let>
           <choose>
             <when>
               <test>
                 <in caseless="yes"><clip pos="4" side="sl" part="lem"/><list n="verbs_reflexius"/></in>
               </test>
               <let><clip pos="3" side="tl" part="lem"/><lit v="se"/></let>
             </when>
             <otherwise>
               <let><clip pos="3" side="tl" part="lem"/><lit v="si"/></let>
             </otherwise>
           </choose>
         </when>
         <otherwise>
           <let><var n="aux1"/><lit-tag v="prn.pro"/></let>
         </otherwise>
       </choose>
       <out>
         <chunk name="prn_ifi" case="caseFirstWord">
           <tags>
             <tag><lit-tag v="SV"/></tag>
             <tag><clip pos="4" side="tl" part="a_verb"/></tag>
             <tag><lit-tag v="ifi"/></tag>
             <tag><clip pos="1" side="tl" part="pers"/></tag>
             <tag><clip pos="1" side="tl" part="nbr"/></tag>
           </tags>
             <lu>
               <get-case-from pos="1">
                 <clip pos="3" side="tl" part="lem"/>
               </get-case-from>
               <var n="aux1"/>
               <clip pos="3" side="tl" part="pers"/>
               <clip pos="3" side="tl" part="gen"/>
               <clip pos="3" side="tl" part="nbr"/>
             </lu>
             <b pos="1"/>
             <lu>
               <clip pos="2" side="tl" part="lemh"/>
               <clip pos="2" side="tl" part="a_verb"/>
               <lit-tag v="ifi"/>
               <clip pos="1" side="tl" part="pers"/>
               <clip pos="1" side="tl" part="nbr"/>
               <clip pos="2" side="tl" part="lemq"/>
             </lu>
             <b pos="3"/>
             <lu>
               <clip pos="4" side="tl" part="lemh"/>
               <clip pos="4" side="tl" part="a_verb"/>
               <clip pos="4" side="tl" part="temps"/>
               <clip pos="4" side="tl" part="gen"/>
               <clip pos="4" side="tl" part="nbr"/>
               <clip pos="4" side="tl" part="lemq"/>
             </lu>
         </chunk>
       </out>
         </otherwise>
       </choose>
     </action>
  </rule>

  <!-- fi REGLES passat perifràstic -->

  <rule comment="regla: final de frase: reset de variables">
     <pattern>
       <pattern-item n="final_sent"/>
     </pattern>
     <action>
      <let> <var n="genero"/><lit-tag v="m"/></let>
      <let> <var n="numero"/><lit-tag v="sg"/></let>
      <let> <var n="EOS"/><lit v="false"/></let>
      <let><var n="lemma"/><clip pos="1" side="tl" part="lem"/></let>
        <out>
          <chunk namefrom="lemma">
            <tags>
              <tag><lit-tag v="sent"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu>
          </chunk>
        </out>
     </action>
  </rule>

  </section-rules>
</transfer>
